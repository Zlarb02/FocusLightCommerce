<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alto Lille</title>
    <meta
      name="description"
      content="Lampe d'appoint FOCUS.01 écologique et design, fabriquée en PLA écoresponsable et en chêne écogéré. Disponible en 4 couleurs."
    />
    <link rel="icon" type="image/png" href="/images/logo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600&family=Jost:wght@500;600;700&family=League+Spartan:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #fff;
        --text-color: #111;
        --text-light: #777777;
        --polaroid-border: #ffffff; /* Couleur opaque pour le verso des polaroids */
        --polaroid-shadow: rgba(0, 0, 0, 0.15);
        --scroll-indicator-bg: rgba(255, 255, 255, 0.75);
        --scroll-indicator-shadow: rgba(0, 0, 0, 0.1);
        --toggle-bg: #f0f0f0;
        --toggle-bg-active: #2196f3;
        --toggle-knob: #fff;

        /* Polices principales */
        --font-primary: "Noto Sans", system-ui, sans-serif;
        --font-heading: "Jost", system-ui, sans-serif;
        --font-accent: "League Spartan", system-ui, sans-serif;

        /* Variantes fonctionnelles par usage */
        --font-body: var(--font-primary);
        --font-titles: var(--font-heading);
        --font-buttons: var(--font-accent);
        --font-nav: var(--font-accent);

        /* Graisses typographiques */
        --fw-light: 300;
        --fw-regular: 400;
        --fw-medium: 500;
        --fw-semibold: 600;
        --fw-bold: 700;
      }

      .dark-mode {
        --bg-color: #000000;
        --text-color: #f5f5f5;
        --text-light: #b0b0b0;
        --polaroid-border: #000000;
        --polaroid-shadow: rgba(0, 0, 0, 0.9);
        --scroll-indicator-bg: rgba(30, 30, 30, 0.85);
        --scroll-indicator-shadow: rgba(0, 0, 0, 0.6);
        --toggle-bg: #2a2a2a;
        --toggle-bg-active: #4a9eff;
        --toggle-knob: #f8f8f8;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
        background: var(--bg-color);
        font-family: var(--font-body);
        color: var(--text-color);
        transition: background 0.3s, color 0.3s;
      }
      #landing-container {
        background: var(--bg-color);
      }
      #webgl {
        position: fixed;
        inset: 0;
        transition: margin-left 0.3s ease-out;
      }
      #scrollArea {
        height: 800vh;
      }
      .caption {
        position: fixed;
        max-width: 35vw;
        font-size: clamp(18px, 3.5vw, 36px);
        line-height: 1.25;
        font-weight: var(--fw-medium);
        opacity: 0;
        transition: opacity 0.4s, color 0.3s;
        pointer-events: none;
        font-family: var(--font-body);
        color: var(--text-color);
      }
      .tl {
        top: 15%;
        left: 6%;
      }
      .tr {
        top: 15%;
        right: 6%;
      }
      .ml {
        top: 55%;
        left: 6%;
      }
      .mr {
        top: 45%;
        right: 6%;
      }
      .br {
        bottom: 13%;
        right: 6%;
      }
      .bl {
        bottom: 13%;
        left: 6%;
      }
      #cta {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--font-accent);
        font-size: clamp(32px, 6vw, 72px);
        font-weight: var(--fw-bold);
        opacity: 0;
        transition: opacity 0.6s;
        cursor: pointer;
        color: var(--text-color);
      }

      /* Style pour le footer de la landing page uniquement */
      #landing-container footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
        font-size: clamp(0.7rem, 1vw, 0.8rem);
        color: var(--text-light);
        padding: clamp(0.5rem, 1vw, 1rem);
        z-index: 10;
        pointer-events: none;
        font-family: var(--font-body);
        font-weight: var(--fw-regular);
      }

      /* Style pour les toggles en haut à droite */
      .toggle-container {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 15px;
        z-index: 100;
      }

      .toggle {
        position: relative;
        display: flex;
        align-items: center;
      }

      .toggle-label {
        font-size: 14px;
        margin-right: 10px;
        color: var(--text-color);
        font-weight: var(--fw-medium);
        font-family: var(--font-nav);
        user-select: none;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--toggle-bg);
        transition: 0.4s;
        border-radius: 24px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: var(--toggle-knob);
        transition: 0.3s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--toggle-bg-active);
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      /* Configuration de l'effet de parallaxe pour les polaroids */
      .polaroid {
        position: absolute;
        width: 18vw;
        aspect-ratio: 3/4;
        background-size: cover;
        background-position: center;
        z-index: 1;
        opacity: 0;
        transition: opacity 0.4s, transform 0.1s ease-out; /* Ajout de transition pour transform */
      }

      /* Masquer l'app React par défaut */
      #root {
        display: none;
      }

      #landing-container {
        display: block;
      }

      /* Style pour le titre de la marque */
      #brand-title {
        position: absolute;
        top: 8%;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        font-family: var(--font-titles);
        font-size: clamp(32px, 5vw, 58px);
        font-weight: var(--fw-bold);
        color: var(--text-color);
        opacity: 1; /* Toujours visible */
        transition: opacity 0.6s, color 0.3s;
        z-index: 20; /* Au-dessus des polaroids */
        pointer-events: none; /* N'interfère pas avec les clics */
        user-select: none; /* Empêche la sélection */
      }

      /* Style pour l'indicateur de défilement moderne */
      #scroll-indicator {
        position: fixed;
        bottom: 8%;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
        transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 15;
        pointer-events: none;
      }

      /* Animation d'apparition spectaculaire */
      #scroll-indicator.visible {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
        pointer-events: auto;
        animation: fadeInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateX(-50%) translateY(40px) scale(0.8);
        }
        60% {
          opacity: 0.8;
          transform: translateX(-50%) translateY(-8px) scale(1.05);
        }
        100% {
          opacity: 1;
          transform: translateX(-50%) translateY(0) scale(1);
        }
      }

      .scroll-content {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.75) 0%,
          rgba(255, 255, 255, 0.65) 100%
        );
        backdrop-filter: blur(15px) saturate(150%);
        border-radius: 24px;
        padding: 18px 24px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08),
          0 2px 8px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        max-width: 90vw;
        min-width: 300px;
      }

      .product-highlight {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        text-align: center;
      }

      .product-name {
        font-size: clamp(18px, 2.5vw, 24px);
        font-weight: 700;
        font-family: var(--font-titles);
        margin: 0;
        color: var(--text-color);
        letter-spacing: 0.02em;
        background: linear-gradient(
          135deg,
          var(--text-color) 0%,
          var(--text-light) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: none;
      }

      .scroll-badge {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        background: linear-gradient(
          135deg,
          rgba(34, 197, 94, 0.12) 0%,
          rgba(16, 185, 129, 0.12) 100%
        );
        padding: 6px 14px;
        border-radius: 50px;
        border: 1px solid rgba(34, 197, 94, 0.15);
      }

      .availability-dot {
        width: 8px;
        height: 8px;
        background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
        border-radius: 50%;
        animation: pulseGlow 2s infinite;
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
      }

      #scroll-message {
        font-size: clamp(14px, 2vw, 18px);
        font-weight: 600;
        letter-spacing: 0.02em;
        margin: 0;
        color: var(--text-color);
        font-family: var(--font-titles);
        background: linear-gradient(
          135deg,
          var(--text-color) 0%,
          var(--text-light) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      #scroll-icon {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .scroll-arrow-container {
        position: relative;
        width: 40px;
        height: 40px;
        background: linear-gradient(
          135deg,
          var(--text-color) 0%,
          var(--text-light) 100%
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: floatBounce 3s ease-in-out infinite;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .scroll-arrow {
        width: 20px;
        height: 20px;
        color: var(--bg-color);
        transition: transform 0.3s ease;
      }

      .scroll-action {
        font-size: clamp(12px, 1.5vw, 16px);
        font-weight: 500;
        letter-spacing: 0.05em;
        margin: 0;
        color: var(--text-light);
        font-family: var(--font-buttons);
        text-transform: uppercase;
        opacity: 0.8;
        transition: all 0.3s ease;
      }

      .scroll-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120%;
        height: 120%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        border-radius: 50%;
        animation: glowPulse 4s ease-in-out infinite;
        pointer-events: none;
      }

      /* Animations */
      @keyframes pulseGlow {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
        }
        50% {
          box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
      }

      @keyframes floatBounce {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      @keyframes glowPulse {
        0%,
        100% {
          opacity: 0.3;
          transform: translate(-50%, -50%) scale(1);
        }
        50% {
          opacity: 0.6;
          transform: translate(-50%, -50%) scale(1.1);
        }
      }

      /* Effet hover */
      #scroll-indicator:hover .scroll-arrow-container {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
      }

      #scroll-indicator:hover .scroll-action {
        opacity: 1;
        transform: translateY(-2px);
      }

      #scroll-indicator:hover .scroll-arrow {
        transform: translateY(2px);
      }

      /* Style pour les polaroids */
      .polaroid {
        position: absolute;
        width: 18vw;
        aspect-ratio: 3/4;
        z-index: 1;
        opacity: 0;
        perspective: 1000px;
        cursor: pointer;
        border: none;
        background: transparent;
        padding: 0;
        border-radius: 8px;
        transition: opacity 0.3s ease, z-index 0.3s ease;
        outline: none;
        /* Améliorer la performance du parallax */
        will-change: transform;
        backface-visibility: hidden;
        transform-style: preserve-3d;
      }

      /* Désactiver les transitions de transform pour le parallax */
      .polaroid:not(.flipping) {
        transition: opacity 0.3s ease, z-index 0.3s ease;
      }

      /* État de retournement - permettre les transitions sur l'élément inner */
      .polaroid.flipping {
        transition: all 0.3s ease;
      }

      /* Focus visible pour l'accessibilité - complètement supprimé le contour bleu par défaut */
      .polaroid:focus,
      .polaroid:focus-visible,
      .polaroid:focus-within {
        outline: none !important;
        box-shadow: none !important;
        border: none !important;
      }

      /* Supprimer aussi tous les contours par défaut du navigateur et forcer transparent */
      .polaroid *:focus,
      .polaroid *:focus-visible {
        outline: none !important;
        border-color: transparent !important;
      }

      /* Règle globale anti-bleu pour tous les éléments polaroid */
      .polaroid,
      .polaroid * {
        outline-color: transparent !important;
        border-color: transparent !important;
      }

      /* Suppression complète de l'indicateur de focus pour éviter les cadres blancs */
      /* L'accessibilité est maintenue par les attributs ARIA et la navigation au clavier */

      .polaroid-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        transform-style: preserve-3d;
        border-radius: 4px;
        border: 12px solid #ffffff !important; /* Bordure blanche propre */
        background-color: #ffffff; /* Fond blanc pour éviter les espaces transparents */
        overflow: hidden; /* Clipper le contenu aux bords arrondis */
        box-sizing: border-box;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15),
          0 4px 10px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important; /* Ombre visible sur tous les fonds */
      }

      /* États d'interaction */
      .polaroid:hover {
        transform: translateY(-4px);
      }

      .polaroid:hover .polaroid-inner {
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2),
          0 8px 15px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
      }

      .dark-mode .polaroid:hover .polaroid-inner {
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9),
          0 10px 25px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
      }

      .polaroid:active {
        transform: translateY(-1px);
      }

      /* Animation au survol et focus - DÉSACTIVÉ car géré par JavaScript */
      /* Ces règles CSS sont remplacées par la logique JavaScript */

      /* État activé/retourné - corriger pour que l'image ne soit pas retournée */
      .polaroid.flipped .polaroid-inner {
        transform: rotateY(180deg);
      }

      /* Styles pour le recto et le verso */
      .polaroid-front,
      .polaroid-back {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 4px; /* Coins arrondis cohérents avec .polaroid-inner */
        overflow: hidden;
        transition: opacity 0.3s ease,
          transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }

      .polaroid-front {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 1;
        z-index: 2;
        border: none; /* Pas de bordure ici, elle est sur le conteneur parent */
        box-sizing: border-box;
        background-color: #ffffff; /* Fond blanc pour combler les espaces transparents */
      }

      /* Le verso doit afficher le texte normalement (pas retourné) */
      .polaroid-back {
        background: #ffffff; /* Fond blanc opaque */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 30px 20px;
        gap: 12px;
        border-radius: 4px; /* Même border-radius que .polaroid-inner */
        opacity: 0;
        z-index: 1;
        transform: scaleX(-1);
        border: none;
        position: absolute;
        box-shadow: none;
        transition: all 0.3s ease;
      }

      /* Effet de texture subtil - adapté au thème */
      .polaroid-back::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          var(--text-color) 0%,
          transparent 50%,
          var(--text-color) 100%
        );
        opacity: 0.02;
        border-radius: 4px;
        pointer-events: none;
      }

      /* Adaptation en mode sombre */
      .dark-mode .polaroid-back::before {
        background: linear-gradient(
          135deg,
          var(--polaroid-border) 0%,
          transparent 50%,
          var(--polaroid-border) 100%
        );
        opacity: 0.05;
      }

      /* Quand le polaroid est retourné, cacher le front et montrer le back */
      .polaroid.flipped .polaroid-front {
        opacity: 0;
        z-index: 1;
      }

      .polaroid.flipped .polaroid-back {
        opacity: 1;
        z-index: 2;
      }

      /* Les éléments du verso sont déjà dans la bonne orientation grâce au parent */
      .polaroid-back .polaroid-title,
      .polaroid-back .polaroid-description,
      .polaroid-back .polaroid-action {
        /* Pas de transformation supplémentaire nécessaire */
        backface-visibility: visible;
      }

      /* Assurer l'opacité complète du verso en mode clair */
      body:not(.dark-mode) .polaroid-back {
        background: #ffffff !important; /* Fond blanc opaque en mode clair */
        backdrop-filter: none !important; /* Supprimer le flou qui peut causer de la transparence */
      }

      /* Supprimer aussi l'effet de texture en mode clair qui peut créer de la transparence */
      body:not(.dark-mode) .polaroid-back::before {
        display: none !important;
      }

      /* Styles spécifiques pour le texte du verso - design cohérent avec le site */
      .polaroid-back .polaroid-title {
        font-size: clamp(18px, 2.2vw, 24px);
        font-weight: var(--fw-semibold);
        font-family: var(--font-titles);
        margin: 0;
        color: var(--text-color);
        letter-spacing: 0.02em;
        position: relative;
        z-index: 2;
        line-height: 1.2;
      }

      .polaroid-back .polaroid-description {
        font-size: clamp(13px, 1.4vw, 16px);
        font-weight: var(--fw-regular);
        font-family: var(--font-body);
        margin: 4px 0 0 0;
        line-height: 1.4;
        color: var(--text-light);
        text-align: center;
        max-width: 90%;
        position: relative;
        z-index: 2;
      }

      .polaroid-back .polaroid-action {
        font-size: clamp(9px, 1vw, 11px);
        font-weight: var(--fw-medium);
        font-family: var(--font-buttons);
        color: var(--text-color);
        margin-top: 12px;
        padding: 6px 10px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 4px;
        opacity: 1;
        transform: translateY(0);
        box-shadow: none; /* Suppression de l'ombre non pivotée */
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border: 1px solid rgba(255, 255, 255, 0.2); /* Bordure visible */
        cursor: pointer;
        position: relative;
        z-index: 2;
        backdrop-filter: blur(4px);
        max-width: calc(100% - 30px);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .polaroid-back .polaroid-action:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.2) 0%,
          rgba(255, 255, 255, 0.1) 100%
        );
        transform: translateY(-2px);
        box-shadow: none; /* Suppression de l'ombre non pivotée */
        border-color: rgba(
          255,
          255,
          255,
          0.4
        ); /* Bordure plus visible au survol */
        letter-spacing: 0.1em;
      }

      /* Afficher l'action quand le polaroid est retourné - géré par JavaScript */
      .polaroid.flipped .polaroid-action {
        opacity: 1;
        transform: translateY(0);
      }
      /* Positionnement des polaroids */
      .p1 {
        top: 2%; /* Descendu de -6% à 2% */
        left: 5%;
        --rotation: -8deg;
      }
      .p1 .polaroid-inner {
        transform: rotate(-8deg);
      }
      .p1.flipped .polaroid-inner {
        transform: rotate(-8deg) rotateY(180deg);
      }

      .p2 {
        bottom: 2%; /* Remonté de -6% à 2% */
        left: 3%;
        --rotation: 8deg;
      }
      .p2 .polaroid-inner {
        transform: rotate(10deg);
      }
      .p2.flipped .polaroid-inner {
        transform: rotate(10deg) rotateY(180deg);
      }

      .p3 {
        top: 20%;
        right: -2%;
        --rotation: 5deg;
      }
      .p3 .polaroid-inner {
        transform: rotate(5deg);
      }
      .p3.flipped .polaroid-inner {
        transform: rotate(5deg) rotateY(180deg);
      }

      .p4 {
        left: 2%;
        top: 36%;
        --rotation: -4deg;
      }
      .p4 .polaroid-inner {
        transform: rotate(-6deg);
      }
      .p4.flipped .polaroid-inner {
        transform: rotate(-6deg) rotateY(180deg);
      }

      .p5 {
        right: -1%;
        bottom: 2%; /* Remonté de -4% à 2% */
        --rotation: -12deg;
      }
      .p5 .polaroid-inner {
        transform: rotate(-12deg);
      }
      .p5.flipped .polaroid-inner {
        transform: rotate(-12deg) rotateY(180deg);
      }

      /* Correction spécifique pour le bouton CTA de p5 */
      .p5 .polaroid-action {
        pointer-events: auto !important;
        z-index: 10 !important;
        position: relative;
        touch-action: manipulation;
      }

      .p6 {
        top: 10%;
        right: 13%;
        --rotation: 7deg;
        z-index: 0;
      }
      .p6 .polaroid-inner {
        transform: rotate(7deg);
      }
      .p6.flipped .polaroid-inner {
        transform: rotate(7deg) rotateY(180deg);
      }

      /* Animations pour l'ancien style - à conserver pour compatibilité */

      /* Amélioration spécifique pour très petits écrans (320-500px) */
      @media (min-width: 320px) and (max-width: 500px) {
        #brand-title {
          top: 4%;
          font-size: clamp(22px, 6.5vw, 30px);
          font-weight: var(--fw-bold);
          letter-spacing: 0.5px;
        }

        .polaroid {
          width: 42vw; /* Augmenté significativement pour meilleure lisibilité */
          min-width: 140px;
          max-width: 180px;
        }

        /* Améliorer la lisibilité du texte sur les polaroids */
        .polaroid-title {
          font-size: 16px; /* Augmenté pour très petits écrans */
          line-height: 1.2;
          margin-bottom: 8px;
          font-weight: var(--fw-semibold);
        }

        .polaroid-description {
          font-size: 14px; /* Augmenté pour très petits écrans */
          line-height: 1.3;
          margin-bottom: 12px;
        }

        .polaroid-action {
          font-size: 13px; /* Augmenté pour très petits écrans */
          padding: 12px 18px;
          min-height: 44px;
          font-weight: var(--fw-medium);
        }

        .polaroid-back {
          padding: 24px 18px; /* Augmenté pour meilleure lisibilité */
          gap: 8px;
        }

        /* Optimiser l'indicateur de scroll pour éviter qu'il cache les polaroids */
        #scroll-indicator {
          bottom: 4%;
          left: 50%;
          transform: translateX(-50%);
        }

        .scroll-content {
          padding: 12px 16px;
          gap: 0.7rem;
          border-radius: 18px;
          min-width: 260px;
          max-width: 90vw;
        }

        /* Ajuster les positions des polaroids pour éviter les conflits avec l'indicateur */
        .p2 {
          bottom: 8%; /* Remonté pour éviter l'indicateur de scroll */
        }

        .p5 {
          bottom: 8%; /* Remonté pour éviter l'indicateur de scroll */
        }
      }

      /* Amélioration pour très petits écrans (fallback pour < 320px) */
      @media (max-width: 319px) {
        #brand-title {
          top: 5%;
          font-size: clamp(20px, 7vw, 28px);
        }

        .polaroid {
          width: 45vw; /* Encore plus grand pour les très petits écrans */
          min-width: 130px;
        }

        .polaroid-title {
          font-size: 15px;
          line-height: 1.3;
          margin-bottom: 7px;
        }

        .polaroid-description {
          font-size: 13px;
          line-height: 1.4;
          margin-bottom: 11px;
        }

        .polaroid-action {
          font-size: 12px;
          padding: 11px 17px;
          min-height: 42px;
        }
      }

      /* Amélioration pour petits écrans intermédiaires (501-600px) */
      @media (min-width: 501px) and (max-width: 600px) {
        #brand-title {
          top: 5.5%;
          font-size: clamp(26px, 5.5vw, 34px);
        }

        .polaroid {
          width: 38vw; /* Taille intermédiaire optimisée */
          min-width: 150px;
        }

        .polaroid-title {
          font-size: 17px;
          line-height: 1.3;
          margin-bottom: 8px;
        }

        .polaroid-description {
          font-size: 15px;
          line-height: 1.4;
          margin-bottom: 12px;
        }

        .polaroid-action {
          font-size: 14px;
          padding: 12px 19px;
          min-height: 44px;
        }

        .polaroid-back {
          padding: 24px 18px;
          gap: 8px;
        }

        /* Optimiser l'indicateur de scroll */
        #scroll-indicator {
          bottom: 5%;
        }
      }

      /* Amélioration pour mobile */
      @media (min-width: 481px) and (max-width: 767px) {
        #brand-title {
          top: 6%;
          font-size: clamp(28px, 5.5vw, 38px);
        }

        .polaroid {
          width: 35vw; /* Augmenté pour meilleure lisibilité */
          min-width: 140px;
        }

        .polaroid-title {
          font-size: 16px; /* Augmenté pour meilleure lisibilité */
          line-height: 1.3;
          margin-bottom: 8px;
        }

        .polaroid-description {
          font-size: 14px; /* Augmenté pour meilleure lisibilité */
          line-height: 1.4;
          margin-bottom: 12px;
        }

        .polaroid-action {
          font-size: 13px; /* Augmenté pour meilleure lisibilité */
          padding: 12px 19px;
          min-height: 44px;
        }

        /* Ajuster l'espacement interne du verso */
        .polaroid-back {
          padding: 22px 16px; /* Augmenté pour meilleure lisibilité */
          gap: 7px;
        }

        /* Instructions visuelles supprimées sur mobile pour éviter la surcharge visuelle */

        /* Optimisation moderne de l'indicateur de défilement pour mobile */
        #scroll-indicator {
          bottom: 6%;
        }

        .scroll-content {
          padding: 14px 18px;
          gap: 0.8rem;
          border-radius: 20px;
          min-width: 280px;
          max-width: 85vw;
          backdrop-filter: blur(12px) saturate(130%);
          background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.7) 0%,
            rgba(255, 255, 255, 0.6) 100%
          );
        }

        .product-name {
          font-size: clamp(16px, 4vw, 20px);
          font-weight: 700;
        }

        .scroll-badge {
          padding: 5px 12px;
          gap: 0.5rem;
        }

        .availability-dot {
          width: 6px;
          height: 6px;
        }

        #scroll-message {
          font-size: clamp(12px, 3.5vw, 15px);
          font-weight: 600;
        }

        .scroll-arrow-container {
          width: 36px;
          height: 36px;
          animation: floatBounceMobile 3s ease-in-out infinite;
        }

        .scroll-arrow {
          width: 18px;
          height: 18px;
        }

        .scroll-action {
          font-size: clamp(11px, 3vw, 14px);
        }

        .scroll-glow {
          animation: glowPulseMobile 5s ease-in-out infinite;
        }

        @keyframes floatBounceMobile {
          0%,
          100% {
            transform: translateY(0px);
          }
          50% {
            transform: translateY(-6px);
          }
        }

        @keyframes glowPulseMobile {
          0%,
          100% {
            opacity: 0.2;
            transform: translate(-50%, -50%) scale(1);
          }
          50% {
            opacity: 0.4;
            transform: translate(-50%, -50%) scale(1.05);
          }
        }

        /* Désactiver l'effet de survol sur les appareils tactiles */
        .touch-device .polaroid:hover .polaroid-inner {
          transform: none;
        }

        /* Désactiver les effets de survol pour les appareils tactiles */
        .touch-device .polaroid:hover .polaroid-inner {
          transform: rotate(var(--rotation, 0deg)) !important;
        }

        /* Forcer l'état normal des rotations pour les appareils tactiles */
        .touch-device .p1 .polaroid-inner {
          transform: rotate(-8deg);
        }
        .touch-device .p2 .polaroid-inner {
          transform: rotate(10deg);
        }
        .touch-device .p3 .polaroid-inner {
          transform: rotate(5deg);
        }
        .touch-device .p4 .polaroid-inner {
          transform: rotate(-6deg);
        }
        .touch-device .p5 .polaroid-inner {
          transform: rotate(-12deg);
        }
        .touch-device .p6 .polaroid-inner {
          transform: rotate(7deg);
        }

        /* États retournés pour appareils tactiles */
        .touch-device .p1.flipped .polaroid-inner {
          transform: rotate(-8deg) rotateY(180deg);
        }
        .touch-device .p2.flipped .polaroid-inner {
          transform: rotate(10deg) rotateY(180deg);
        }
        .touch-device .p3.flipped .polaroid-inner {
          transform: rotate(5deg) rotateY(180deg);
        }
        .touch-device .p4.flipped .polaroid-inner {
          transform: rotate(-6deg) rotateY(180deg);
        }
        .touch-device .p5.flipped .polaroid-inner {
          transform: rotate(-12deg) rotateY(180deg);
        }
        .touch-device .p6.flipped .polaroid-inner {
          transform: rotate(7deg) rotateY(180deg);
        }

        /* Améliorer la visibilité du focus sur les appareils tactiles - sans contour bleu */
        .touch-device .polaroid:focus-visible {
          outline: none !important;
          box-shadow: none !important;
        }
      }

      /* Amélioration pour tablette */
      @media (min-width: 768px) and (max-width: 1024px) {
        #brand-title {
          top: 7%;
          font-size: clamp(36px, 5vw, 48px);
        }

        .polaroid {
          width: 22vw; /* Légèrement augmenté pour meilleure visibilité */
          min-width: 170px;
        }

        .polaroid-title {
          font-size: 17px; /* Augmenté pour meilleure lisibilité */
          line-height: 1.3;
        }

        .polaroid-description {
          font-size: 15px; /* Augmenté pour meilleure lisibilité */
          line-height: 1.4;
        }

        .polaroid-action {
          font-size: 14px; /* Augmenté pour meilleure lisibilité */
          padding: 11px 19px;
          min-height: 42px;
        }

        .polaroid-back {
          padding: 24px 17px; /* Augmenté pour meilleure lisibilité */
          gap: 9px;
        }

        /* Optimisation moderne de l'indicateur de défilement pour tablette */
        #scroll-indicator {
          bottom: 7%;
        }

        .scroll-content {
          padding: 16px 22px;
          gap: 0.9rem;
          border-radius: 22px;
          min-width: 320px;
          max-width: 80vw;
          background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.72) 0%,
            rgba(255, 255, 255, 0.62) 100%
          );
        }

        .product-name {
          font-size: clamp(17px, 2.8vw, 22px);
        }

        .scroll-badge {
          padding: 6px 13px;
          gap: 0.6rem;
        }

        .availability-dot {
          width: 7px;
          height: 7px;
        }

        #scroll-message {
          font-size: clamp(14px, 2.5vw, 17px);
        }

        .scroll-arrow-container {
          width: 38px;
          height: 38px;
        }

        .scroll-arrow {
          width: 19px;
          height: 19px;
        }

        .scroll-action {
          font-size: clamp(13px, 2vw, 16px);
        }
      }

      /* Optimisation pour les grands écrans */
      @media (min-width: 1441px) and (max-width: 1919px) {
        .polaroid {
          width: 18vw; /* Taille standard optimisée pour les grands écrans */
          min-width: 220px;
        }

        .polaroid-title {
          font-size: 20px;
          line-height: 1.3;
          font-weight: 600;
        }

        .polaroid-description {
          font-size: 18px;
          line-height: 1.4;
          margin-bottom: 14px;
        }

        .polaroid-action {
          font-size: 17px;
          padding: 14px 22px;
          min-height: 46px;
        }

        .polaroid-back {
          padding: 30px 22px;
          gap: 14px;
        }

        /* Optimiser l'indicateur de défilement pour les grands écrans */
        #scroll-indicator {
          bottom: 8%;
        }

        .scroll-content {
          padding: 20px 28px;
          gap: 1.2rem;
          border-radius: 26px;
          min-width: 380px;
          max-width: 500px;
        }

        .product-name {
          font-size: clamp(22px, 2.2vw, 28px);
        }

        .scroll-badge {
          padding: 8px 16px;
          gap: 0.8rem;
        }

        .availability-dot {
          width: 8px;
          height: 8px;
        }

        #scroll-message {
          font-size: clamp(16px, 1.8vw, 20px);
        }

        .scroll-arrow-container {
          width: 42px;
          height: 42px;
        }

        .scroll-arrow {
          width: 21px;
          height: 21px;
        }

        .scroll-action {
          font-size: clamp(15px, 1.5vw, 18px);
        }
      }

      /* Optimisations pour les très grandes tailles d'écran */
      @media (min-width: 1920px) and (max-width: 2559px) {
        .polaroid {
          width: 16vw;
          min-width: 240px;
          max-width: 320px;
        }

        .polaroid-title {
          font-size: 22px;
          line-height: 1.3;
          font-weight: 600;
        }

        .polaroid-description {
          font-size: 18px;
          line-height: 1.4;
          margin-bottom: 16px;
        }

        .polaroid-action {
          font-size: 18px;
          padding: 16px 24px;
          min-height: 48px;
        }

        .polaroid-back {
          padding: 32px 24px;
          gap: 16px;
        }
      }

      /* Amélioration pour les écrans ultra-larges */
      @media (min-width: 2560px) {
        .polaroid {
          width: 14vw;
          min-width: 260px;
          max-width: 340px;
        }

        .polaroid-title {
          font-size: 24px;
          line-height: 1.3;
          font-weight: 600;
        }

        .polaroid-description {
          font-size: 20px;
          line-height: 1.4;
          margin-bottom: 18px;
        }

        .polaroid-action {
          font-size: 19px;
          padding: 18px 26px;
          min-height: 50px;
        }

        .polaroid-back {
          padding: 36px 26px;
          gap: 18px;
        }
      }

      /* État de chargement pour les transitions */
      .polaroid.loading .polaroid-inner {
        pointer-events: none;
      }

      .polaroid.loading .polaroid-focus-indicator {
        border-color: transparent; /* Suppression des bordures de chargement */
        animation: none; /* Suppression de l'animation pulse qui pourrait créer des cadres */
      }

      /* Amélioration de la visibilité du texte sur le verso */
      .polaroid-back {
        background: linear-gradient(
          135deg,
          var(--bg-color) 0%,
          var(--polaroid-border) 100%
        );
        backdrop-filter: blur(2px);
      }

      /* Protection contre les clics multiples */
      .polaroid[aria-busy="true"] {
        pointer-events: none;
        opacity: 0.7;
      }

      /* Feedback visuel pour les interactions réussies */
      .polaroid.success .polaroid-inner {
        animation: clickSuccess 0.3s ease;
      }

      /* Style pour l'annonceur de lecteur d'écran (caché visuellement) */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Mode haute-contraste - suppression des bordures */
      @media (prefers-contrast: high) {
        .polaroid-inner {
          border: none; /* Suppression des bordures en mode haute-contraste */
        }

        .polaroid:focus-visible {
          outline: none; /* Suppression complète du contour */
        }

        .polaroid-focus-indicator {
          border-width: 0px; /* Suppression de l'épaisseur de bordure */
        }
      }

      /* Animation d'attention pour guider l'utilisateur */
      .polaroid.attention {
        animation: polaroidPulse 2s ease-in-out 3;
      }

      /* État désactivé si nécessaire */
      .polaroid:disabled,
      .polaroid[aria-disabled="true"] {
        opacity: 0.5;
        pointer-events: none;
        cursor: not-allowed;
      }

      /* Amélioration de la transition de focus - sans contour bleu */
      .polaroid:focus-within .polaroid-focus-indicator {
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        box-shadow: none;
      }

      /* ===== AMÉLIORATIONS SPÉCIFIQUES POUR LE MODE SOMBRE ===== */

      /* Amélioration des polaroids en mode sombre */
      .dark-mode .polaroid-inner {
        border: 12px solid #ffffff; /* Bordure blanche propre */
        box-sizing: border-box;
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.8),
          0 6px 15px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 0.15); /* Ombre renforcée pour fond noir */
      }

      .dark-mode .polaroid-back {
        background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
        border: none; /* Pas de bordure pour un rendu moderne et épuré */
        box-shadow: none; /* Pas d'ombre pour un rendu épuré */
      }

      /* Texte plus lisible sur fond sombre */
      .dark-mode .polaroid-back .polaroid-title {
        color: #ffffff;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      }

      .dark-mode .polaroid-back .polaroid-description {
        color: #cccccc;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
      }

      /* Bouton d'action amélioré en mode sombre */
      .dark-mode .polaroid-back .polaroid-action {
        background: linear-gradient(135deg, #2a2a2a 0%, #1a1a2a 100%);
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.1); /* Bordure visible en mode sombre */
        box-shadow: none; /* Suppression de l'ombre non pivotée */
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      }

      .dark-mode .polaroid-back .polaroid-action:hover {
        background: linear-gradient(135deg, #3a3a3a 0%, #2a2a2a 100%);
        border-color: rgba(
          255,
          255,
          255,
          0.2
        ); /* Bordure plus visible au survol */
        box-shadow: none; /* Suppression de l'ombre non pivotée */
        transform: translateY(-2px);
      }

      /* Amélioration des bordures des polaroids en mode sombre */
      .dark-mode .polaroid-front {
        border: none;
        box-shadow: none;
      }

      /* Effet de lueur subtile sur le recto en mode sombre - SUPPRIMÉ */
      .dark-mode .polaroid-front {
        box-shadow: none; /* Suppression complète des ombres */
      }

      /* Amélioration de l'indicateur de focus en mode sombre - SUPPRIMÉ */
      .dark-mode .polaroid:focus .polaroid-focus-indicator,
      .dark-mode .polaroid:focus-visible .polaroid-focus-indicator {
        border-color: transparent; /* Suppression de la bordure blanche */
        box-shadow: none; /* Suppression de l'ombre blanche */
        opacity: 0; /* Désactiver complètement */
      }

      /* Amélioration de l'effet de texture en mode sombre */
      .dark-mode .polaroid-back::before {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08) 0%,
          transparent 50%,
          rgba(255, 255, 255, 0.02) 100%
        );
        opacity: 1;
      }

      /* Amélioration de l'ombre des polaroids en mode sombre - SUPPRIMÉ */
      .dark-mode .polaroid-inner {
        box-shadow: none; /* Suppression de toutes les ombres non pivotées */
      }

      /* Amélioration du survol des polaroids en mode sombre - SUPPRIMÉ */
      .dark-mode .polaroid:hover {
        transform: translateY(-3px);
      }

      .dark-mode .polaroid:hover .polaroid-inner {
        box-shadow: none; /* Suppression de toutes les ombres de survol */
      }

      /* Amélioration de l'interface globale en mode sombre */
      .dark-mode #brand-title {
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
      }

      .dark-mode .caption {
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
      }

      .dark-mode #cta {
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
      }

      /* Amélioration de l'indicateur de défilement en mode sombre */
      .dark-mode .scroll-content {
        background: linear-gradient(
          135deg,
          rgba(30, 30, 30, 0.8) 0%,
          rgba(20, 20, 20, 0.75) 100%
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      .dark-mode .product-name {
        background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .dark-mode .scroll-badge {
        background: linear-gradient(
          135deg,
          rgba(34, 197, 94, 0.15) 0%,
          rgba(16, 185, 129, 0.15) 100%
        );
        border: 1px solid rgba(34, 197, 94, 0.25);
      }

      .dark-mode #scroll-message {
        background: linear-gradient(135deg, var(--text-color) 0%, #ffffff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .dark-mode .scroll-arrow-container {
        background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .dark-mode .scroll-arrow {
        color: #1a1a1a;
      }

      .dark-mode .scroll-glow {
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.05) 0%,
          transparent 70%
        );
      }

      /* Amélioration des toggles en mode sombre */
      .dark-mode .toggle-label {
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      }

      .dark-mode .slider {
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .dark-mode .slider:before {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      /* Amélioration du footer en mode sombre */
      .dark-mode footer {
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        color: #888888;
      }

      /* Animation d'entrée améliorée pour le mode sombre */
      .dark-mode .polaroid {
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }

      /* Amélioration des contrastes pour l'accessibilité en mode sombre */
      @media (prefers-contrast: high) {
        .dark-mode .polaroid-back .polaroid-title {
          color: #ffffff;
        }

        .dark-mode .polaroid-back .polaroid-description {
          color: #e0e0e0;
        }

        .dark-mode .polaroid-back .polaroid-action {
          background: #333333;
          color: #ffffff;
          border: none; /* Suppression de la bordure clignotante */
        }

        /* ===== FIN DES AMÉLIORATIONS MODE SOMBRE ===== */

        /* SOLUTION DRASTIQUE UNIVERSELLE - Boutons visibles sur TOUS les appareils */
        /* Suppression de toutes les conditions restrictives */
        .polaroid .polaroid-action,
        .polaroid-back .polaroid-action,
        .polaroid-inner .polaroid-action,
        .polaroid .polaroid-back .polaroid-action,
        .p1 .polaroid-action,
        .p2 .polaroid-action,
        .p3 .polaroid-action,
        .p4 .polaroid-action,
        .p5 .polaroid-action,
        .p6 .polaroid-action {
          opacity: 1;
          visibility: visible;
          display: block;
          pointer-events: auto;
          position: relative;
          z-index: 999;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          border: 2px solid white !important;

          /* Taille optimale pour tous les appareils */
          font-size: 11px !important;
          padding: 8px 12px !important;
          margin: 4px auto 0 auto !important;
          min-height: 36px !important;
          min-width: 80px !important;
          max-width: 90% !important;

          /* Contraintes pour un affichage parfait */
          box-sizing: border-box !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
          white-space: nowrap !important;

          /* Style visible et contrasté sur tous appareils */
          border-radius: 4px !important;
          cursor: pointer !important;

          /* Transition douce pour effet de survol desktop */
          transition: all 0.2s ease !important;
        }

        /* Réduire drastiquement le padding du verso */
        .polaroid-back {
          padding: 8px 6px !important;
          box-sizing: border-box !important;
          overflow: hidden !important;
          display: flex !important;
          flex-direction: column !important;
          justify-content: center !important;
          align-items: center !important;
        }

        /* Réduire la taille du texte pour plus d'espace */
        .polaroid-title {
          font-size: 12px !important;
          margin-bottom: 4px !important;
          line-height: 1.2 !important;
        }

        .polaroid-description {
          font-size: 10px !important;
          margin-bottom: 4px !important;
          line-height: 1.2 !important;
          max-height: 3em !important;
          overflow: hidden !important;
        }

        /* Zone cliquable augmentée */
        .polaroid {
          padding: 4px !important;
          margin: 2px !important;
        }

        /* Feedback tactile */
        .polaroid:active {
          transform: scale(0.98) !important;
          transition: transform 0.1s ease !important;
        }
      }

      /* Force l'affichage des boutons d'action sur tous les polaroids */
      .polaroid-back .polaroid-action {
        opacity: 1 !important;
        visibility: visible !important;
        display: block !important;
        pointer-events: auto !important;
        z-index: 10 !important;
        position: relative !important;
        margin: 8px auto 0 auto !important; /* Centrage et espacement contrôlé */
      }

      /* Protection supplémentaire contre les changements d'opacité intempestifs */
      .polaroid-action[data-touch-visible="true"] {
        opacity: 1 !important;
        visibility: visible !important;
        display: block !important;
        transition: none !important;
      }

      /* SOLUTION ULTIME - Forcer l'affichage avec sélecteur ultra-spécifique */
      .polaroid .polaroid-back .polaroid-action {
        opacity: 1 !important;
        display: block !important;
        visibility: visible !important;
      }

      /* Optimiser l'espace pour les pouces sur les bords */
      .p1,
      .p3,
      .p6 {
        margin-left: 8px;
      }

      .p2,
      .p4,
      .p5 {
        margin-right: 8px;
      }

      /* Éviter que les polaroids soient trop près du scroll indicator */
      .p2,
      .p5 {
        margin-bottom: 60px;
      }

      /* Amélioration pour les écrans avec densité élevée (Retina) sur petits écrans */
      @media (max-width: 500px) and (-webkit-min-device-pixel-ratio: 2) {
        .polaroid-title {
          font-size: 17px; /* Légèrement plus grand sur écrans haute densité */
        }

        .polaroid-description {
          font-size: 15px;
        }

        .polaroid-action {
          font-size: 14px;
        }
      }

      /* OPTIMISATIONS CRITIQUES POUR TRÈS PETITS ÉCRANS (≤320px) */
      @media (max-width: 320px) {
        /* Réduction drastique des polaroids pour éviter les débordements */
        .polaroid {
          width: 140px !important;
          height: 180px !important;
          margin: 3px !important;
          padding: 2px !important;
        }

        .polaroid-inner {
          width: 136px !important;
          height: 176px !important;
        }

        .polaroid-front,
        .polaroid-back {
          width: 136px !important;
          height: 176px !important;
          padding: 6px !important;
        }

        /* Centrage optimal du verso des polaroids */
        .polaroid-back {
          display: flex !important;
          flex-direction: column !important;
          justify-content: center !important;
          align-items: center !important;
          text-align: center !important;
          box-sizing: border-box !important;
        }

        /* Texte ultra-compact mais lisible et bien centré */
        .polaroid-title {
          font-size: 11px !important;
          line-height: 1.2 !important;
          margin-bottom: 3px !important;
          max-height: 2.4em !important;
          overflow: hidden !important;
          text-align: center !important;
          width: 100% !important;
          display: block !important;
        }

        .polaroid-description {
          font-size: 9px !important;
          line-height: 1.3 !important;
          margin-bottom: 4px !important;
          max-height: 2.6em !important;
          overflow: hidden !important;
          text-align: center !important;
          width: 100% !important;
          display: block !important;
        }

        /* Boutons d'action parfaitement centrés et esthétiques */
        .polaroid-action {
          font-size: 9px !important;
          padding: 5px 8px !important;
          min-height: 26px !important;
          min-width: 55px !important;
          max-width: 115px !important;
          margin: 4px auto 0 auto !important;
          border-radius: 3px !important;
          line-height: 1.2 !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          text-align: center !important;
          background: rgba(0, 0, 0, 0.8) !important;
          color: white !important;
          border: 1px solid rgba(255, 255, 255, 0.3) !important;
          font-weight: 500 !important;
          letter-spacing: 0.3px !important;
        }

        /* Centrage optimal des polaroids dans l'espace disponible */
        .p1 {
          left: 2% !important;
          margin-left: 3px !important;
        }

        .p2 {
          left: 50% !important;
          transform: translateX(-50%) rotate(10deg) !important;
          margin-bottom: 50px !important;
        }

        .p3 {
          right: 2% !important;
          margin-right: 3px !important;
        }

        .p4 {
          left: 1% !important;
          margin-left: 3px !important;
        }

        .p5 {
          right: 1% !important;
          margin-right: 3px !important;
          margin-bottom: 50px !important;
        }

        .p6 {
          right: 8% !important;
          margin-right: 3px !important;
        }

        /* Optimisation de l'encart du bas - CRITIQUE */
        .scroll-content {
          width: 280px !important;
          max-width: calc(100vw - 20px) !important;
          padding: 8px !important;
          margin: 0 auto !important;
          left: 50% !important;
          transform: translateX(-50%) !important;
          box-sizing: border-box !important;
        }

        .product-name {
          font-size: 14px !important;
          line-height: 1.2 !important;
          margin-bottom: 4px !important;
        }

        #cta {
          font-size: 10px !important;
          padding: 8px 12px !important;
          min-height: 32px !important;
          margin: 6px auto !important;
          max-width: 200px !important;
        }

        #scroll-message {
          font-size: 8px !important;
          line-height: 1.2 !important;
          margin: 4px 0 !important;
        }

        /* Flèche de scroll plus compacte */
        .scroll-arrow-container {
          width: 24px !important;
          height: 24px !important;
          margin: 4px auto !important;
        }

        .scroll-arrow {
          font-size: 12px !important;
        }

        /* Réduction des marges générales */
        #landing-container {
          padding: 5px !important;
        }

        /* Titre principal plus compact */
        #brand-title {
          font-size: 20px !important;
          line-height: 1.1 !important;
          margin-bottom: 8px !important;
        }

        .caption {
          font-size: 10px !important;
          line-height: 1.2 !important;
          margin-bottom: 10px !important;
        }

        /* Toggles plus compacts */
        .toggle-container {
          top: 5px !important;
          right: 5px !important;
          gap: 4px !important;
        }

        .toggle-label {
          font-size: 8px !important;
        }

        .slider {
          width: 30px !important;
          height: 16px !important;
        }

        .slider:before {
          width: 12px !important;
          height: 12px !important;
        }

        /* Footer ultra-compact */
        footer {
          font-size: 7px !important;
          padding: 4px !important;
          line-height: 1.1 !important;
        }

        /* Espacement optimisé entre polaroids pour éviter les chevauchements */
        .p1,
        .p3,
        .p6 {
          margin-left: 4px !important;
        }

        .p2,
        .p4,
        .p5 {
          margin-right: 4px !important;
        }

        .p2,
        .p5 {
          margin-bottom: 50px !important;
        }

        /* Amélioration de la lisibilité globale */
        #landing-container {
          padding: 6px !important;
        }

        /* Titre principal optimisé et centré */
        #brand-title {
          font-size: 22px !important;
          line-height: 1.2 !important;
          margin-bottom: 10px !important;
          text-align: center !important;
          letter-spacing: 0.5px !important;
        }

        .caption {
          font-size: 11px !important;
          line-height: 1.3 !important;
          margin-bottom: 12px !important;
          text-align: center !important;
        }

        /* Amélioration de l'interface de contrôle */
        .toggle-container {
          top: 6px !important;
          right: 6px !important;
          gap: 5px !important;
        }

        .toggle-label {
          font-size: 9px !important;
          font-weight: 500 !important;
        }

        .slider {
          width: 32px !important;
          height: 18px !important;
        }

        .slider:before {
          width: 14px !important;
          height: 14px !important;
        }

        /* Footer ultra-compact mais lisible */
        footer {
          font-size: 8px !important;
          padding: 5px !important;
          line-height: 1.2 !important;
          text-align: center !important;
        }
      }
    </style>
    <!-- Chargement de la configuration d'environnement en production -->
    <script>
      window.ENV = { API_URL: "", NODE_ENV: "development" };
    </script>
    <script src="/env-config.js" type="module"></script>
  </head>
  <body>
    <!-- Landing page avec Three.js -->
    <div id="landing-container">
      <!-- Toggles en haut à droite -->
      <div class="toggle-container">
        <div class="toggle">
          <span class="toggle-label" id="theme-label">Thème</span>
          <label class="toggle-switch" aria-label="Interrupteur de thème">
            <input
              type="checkbox"
              id="theme-toggle"
              aria-label="Basculer entre thème clair et sombre"
            />
            <span class="slider"></span>
          </label>
        </div>
        <div class="toggle">
          <span class="toggle-label" id="lang-label">FR</span>
          <label class="toggle-switch" aria-label="Interrupteur de langue">
            <input
              type="checkbox"
              id="lang-toggle"
              aria-label="Basculer entre français et anglais"
            />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <canvas
        id="webgl"
        aria-label="Visualisation 3D de la lampe FOCUS.01"
      ></canvas>
      <div id="scrollArea"></div>

      <p class="caption ml" id="cap0">PLA éco‑responsable</p>
      <p class="caption tr" id="cap1">Montage ultra simple</p>
      <p class="caption mr" id="cap2">Chêne écogéré</p>
      <p class="caption br" id="cap3">
        Conçu & fabriqué par Alto Lille en France
      </p>
      <p class="caption tl" id="cap4">LED 60 W E14 incluse</p>
      <p class="caption bl" id="cap5">Emballage éco‑responsable</p>
      <div id="cta">Visiter la boutique</div>

      <!-- Indicateur de défilement -->
      <div id="scroll-indicator">
        <div class="scroll-content">
          <div class="product-highlight">
            <h3 class="product-name">Lampe Focus.01</h3>
            <div class="scroll-badge">
              <span class="availability-dot"></span>
              <p id="scroll-message">Disponible à la vente</p>
            </div>
          </div>
          <div id="scroll-icon">
            <div class="scroll-arrow-container">
              <svg
                class="scroll-arrow"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7 13L12 18L17 13M7 6L12 11L17 6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <p class="scroll-action">Scroll vers le bas</p>
          </div>
        </div>
        <div class="scroll-glow"></div>
      </div>

      <!-- Titre placé au-dessus des polaroids -->
      <h1 id="brand-title">ALTO LILLE</h1>

      <!-- Polaroids avec images du site -->
      <button
        class="polaroid p1"
        data-link="/sea-cle"
        role="button"
        tabindex="0"
        aria-label="Cliquez pour découvrir Sea-clé - Ramasseur de déchets plastiques. Utilisez Enter ou Espace pour interagir."
        aria-expanded="false"
        aria-describedby="polaroid-help"
        data-title="Sea-clé"
        data-description="Ramasseur de déchets plastiques"
      >
        <div class="polaroid-inner">
          <div
            class="polaroid-front"
            style="background-image: url('/images/sea-cle.jpg')"
            role="img"
            aria-label="Image de Sea-clé"
          ></div>
          <div class="polaroid-back">
            <div class="polaroid-title">Sea-clé</div>
            <div class="polaroid-description">
              Ramasseur de déchets plastiques
            </div>
            <div class="polaroid-action">Cliquez pour explorer →</div>
          </div>
        </div>
      </button>

      <button
        class="polaroid p2"
        data-link="/braderie-de-l-art"
        role="button"
        tabindex="0"
        aria-label="Cliquez pour découvrir Braderie de l'Art - Week-end de création collective. Utilisez Enter ou Espace pour interagir."
        aria-expanded="false"
        aria-describedby="polaroid-help"
        data-title="Braderie de l'Art"
        data-description="Week-end de création collective"
      >
        <div class="polaroid-inner">
          <div
            class="polaroid-front"
            style="background-image: url('/images/braderie-de-l-art.png')"
            role="img"
            aria-label="Image de Braderie de l'Art"
          ></div>
          <div class="polaroid-back">
            <div class="polaroid-title">Braderie de l'Art</div>
            <div class="polaroid-description">
              Week-end de création collective
            </div>
            <div class="polaroid-action">Cliquez pour explorer →</div>
          </div>
        </div>
      </button>

      <button
        class="polaroid p3"
        data-link="/waterfall"
        role="button"
        tabindex="0"
        aria-label="Cliquez pour découvrir Waterfall - Applique murale. Utilisez Enter ou Espace pour interagir."
        aria-expanded="false"
        aria-describedby="polaroid-help"
        data-title="Waterfall"
        data-description="Applique murale"
      >
        <div class="polaroid-inner">
          <div
            class="polaroid-front"
            style="background-image: url('/images/Waterfall.jpg')"
            role="img"
            aria-label="Image de Waterfall"
          ></div>
          <div class="polaroid-back">
            <div class="polaroid-title">Waterfall</div>
            <div class="polaroid-description">Applique murale</div>
            <div class="polaroid-action">Cliquez pour explorer →</div>
          </div>
        </div>
      </button>

      <button
        class="polaroid p4"
        data-link="/without-speaker"
        role="button"
        tabindex="0"
        aria-label="Cliquez pour découvrir Without Speaker - Création innovante. Utilisez Enter ou Espace pour interagir."
        aria-expanded="false"
        aria-describedby="polaroid-help"
        data-title="Without Speaker"
        data-description="Création innovante"
      >
        <div class="polaroid-inner">
          <div
            class="polaroid-front"
            style="background-image: url('/images/lowtech-vynil.jpg')"
            role="img"
            aria-label="Image de Without Speaker"
          ></div>
          <div class="polaroid-back">
            <div class="polaroid-title">Without Speaker</div>
            <div class="polaroid-description">Création innovante</div>
            <div class="polaroid-action">Cliquez pour explorer →</div>
          </div>
        </div>
      </button>

      <button
        class="polaroid p5"
        data-link="/chaussures-custom"
        role="button"
        tabindex="0"
        aria-label="Cliquez pour découvrir Chaussures Custom - L'artisanat rencontre le style personnel. Utilisez Enter ou Espace pour interagir."
        aria-expanded="false"
        aria-describedby="polaroid-help"
        data-title="Chaussures Custom"
        data-description="L'artisanat rencontre le style personnel"
      >
        <div class="polaroid-inner">
          <div
            class="polaroid-front"
            style="background-image: url('/images/chaussures-custom.jpg')"
            role="img"
            aria-label="Image de Chaussures Custom"
          ></div>
          <div class="polaroid-back">
            <div class="polaroid-title">Chaussures Custom</div>
            <div class="polaroid-description">
              L'artisanat rencontre le style personnel
            </div>
            <div class="polaroid-action">Cliquez pour explorer →</div>
          </div>
        </div>
      </button>

      <button
        class="polaroid p6"
        data-link="/anatolle-collet"
        role="button"
        tabindex="0"
        aria-label="Cliquez pour découvrir qui je suis. Utilisez Enter ou Espace pour interagir."
        aria-expanded="false"
        aria-describedby="polaroid-help"
        data-title="Qui suis-je"
        data-description="Rencontrer le créateur"
      >
        <div class="polaroid-inner">
          <div
            class="polaroid-front"
            style="
              background-image: url('https://www.alto-lille.fr/uploads/6d140285-f1c2-4a80-bfde-d9848a4c5f92.jpg');
            "
            role="img"
            aria-label="Portrait du créateur d'Alto Lille"
          ></div>
          <div class="polaroid-back">
            <div class="polaroid-title">Qui suis-je</div>
            <div class="polaroid-description">Rencontrer le créateur</div>
            <div class="polaroid-action">Cliquez pour explorer →</div>
          </div>
        </div>
      </button>

      <!-- Aide à l'accessibilité (cachée visuellement) -->
      <div id="polaroid-help" class="sr-only">
        Utilisez les flèches pour naviguer entre les polaroids. Appuyez sur
        Enter ou Espace pour retourner un polaroid et découvrir son contenu.
        Appuyez à nouveau pour visiter la page dédiée.
      </div>

      <footer
        class="animate fade-in-up delay-8"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
          padding: 16px;
        "
      >
        <p
          style="
            margin: 0;
            font-size: clamp(0.7rem, 1vw, 0.8rem);
            color: var(--text-light);
          "
        >
          © 2025 Alto Lille - Tous droits réservés
        </p>
        <div style="display: flex; align-items: center; gap: 12px">
          <!-- Badge EcoIndex -->
          <a
            href="https://bff.ecoindex.fr/redirect/?url=https://www.alto-lille.fr"
            target="_blank"
            rel="noopener noreferrer"
            title="Voir le score EcoIndex du site"
          >
            <img
              src="https://bff.ecoindex.fr/badge/?theme=light&url=https://www.alto-lille.fr"
              alt="Ecoindex Badge"
              style="height: 20px"
            />
          </a>
          <!-- Mention développeur -->
          <a
            href="https://pogodev.com"
            target="_blank"
            rel="noopener noreferrer"
            style="
              color: var(--text-light);
              text-decoration: none;
              font-size: 0.7rem;
              transition: color 0.3s;
            "
            title="Site développé par Etienne Pogoda"
          >
            Développé par Etienne Pogoda
          </a>
        </div>
      </footer>
    </div>

    <!-- App React (caché par défaut) -->
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <script type="module">
      import * as THREE from "three";
      import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
      import { RoomEnvironment } from "three/addons/environments/RoomEnvironment.js";

      /* ===== CONFIG ===== */
      const CFG = {
        urls: [
          "https://raw.githubusercontent.com/Zlarb02/test-landing/main/src/assets/focus.glb",
          "./focus.glb",
          "/images/focus.glb",
        ],
        intro: 0.08,
        rotEnd: 0.75,
        timeScale: 1.2,
        legend: { seg: 0.12, fade: 0.04 },
        travelAmp:
          matchMedia("(prefers-reduced-motion: reduce)").matches ||
          innerWidth < 600
            ? 0.25
            : 0.6,
        colours: { bg: "#fff", txt: "#111", key: "#ffffff", rim: "#66ccff" },
        // Configuration du déplacement horizontal du canvas
        slideRight: {
          start: 0.6, // Moment où le déplacement commence (correspond au début de la disparition du texte "emballage éco-responsable")
          end: 0.9, // Moment où le déplacement est complet
          // Pourcentage de déplacement vers la droite adapté à la taille de l'écran
          amount: calculateSlideAmount(),
        },
      };
      /* helpers */
      const L = (a, b, t) => a + (b - a) * t,
        C = (v) => Math.max(0, Math.min(v, 1));

      // Fonction pour calculer la valeur optimale de slideRight.amount en fonction de la taille de l'écran
      function calculateSlideAmount() {
        if (innerWidth <= 600) {
          return 36; // 40% pour les mobiles (petits écrans)
        } else if (innerWidth > 1500) {
          return 20; // 20% pour les grands écrans
        } else {
          return 25; // 25% pour les écrans moyens (par défaut)
        }
      }

      /* ===== RENDERER & SCENE ===== */
      // Déterminer si nous sommes sur un grand écran (largeur > 1440px)
      const isLargeScreen = window.innerWidth > 1440;

      const renderer = new THREE.WebGLRenderer({
        canvas: webgl,
        antialias: true, // Toujours activer l'anti-aliasing
        powerPreference: "high-performance",
        precision: isLargeScreen ? "highp" : "mediump",
        stencil: false, // Optimisation pour les performances
      });
      renderer.setSize(innerWidth, innerHeight);

      // Adapter le pixel ratio en fonction de la taille de l'écran
      const maxPixelRatio = isLargeScreen
        ? Math.min(window.devicePixelRatio, 2)
        : Math.min(window.devicePixelRatio, 1.5);
      renderer.setPixelRatio(maxPixelRatio);

      // Définir la couleur de fond en fonction du thème actuel
      const isDarkMode = document.body.classList.contains("dark-mode");
      renderer.setClearColor(isDarkMode ? "#000000" : CFG.colours.bg, 1);
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.1;

      // Optimisations supplémentaires pour les grands écrans
      if (isLargeScreen) {
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Ombres adoucies
        renderer.outputColorSpace = THREE.SRGBColorSpace; // Espace couleur correct
      }

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        60,
        innerWidth / innerHeight,
        0.1,
        1000
      );
      scene.environment = new THREE.PMREMGenerator(renderer).fromScene(
        new RoomEnvironment(renderer)
      ).texture;
      scene.add(new THREE.AmbientLight(0xffffff, 1));
      [
        ["key", 6, 10, 10],
        ["rim", -6, 7, -10],
      ].forEach(([k, x, y, z]) => {
        const s = new THREE.SpotLight(
          CFG.colours[k],
          1.2,
          0,
          Math.PI / 8,
          0.25
        );
        s.position.set(x, y, z);
        scene.add(s);
      });

      /* ===== LOAD GLB ===== */
      let center = new THREE.Vector3(),
        R = 1,
        r0,
        r1,
        y0,
        y1,
        rIntro,
        yIntro,
        mixer,
        clip = 4,
        act;
      const loader = new GLTFLoader();

      // Encapsulation dans une IIFE async pour éviter le await au niveau supérieur
      (async function loadModel() {
        for (const url of CFG.urls) {
          try {
            await new Promise((res, rej) =>
              loader.load(
                url,
                (g) => {
                  scene.add(g.scene);
                  g.scene.traverse(
                    (o) =>
                      o.material?.isMeshStandardMaterial &&
                      (o.material.envMapIntensity = 1.1)
                  );
                  ({ radius: R, center } = new THREE.Box3()
                    .setFromObject(g.scene)
                    .getBoundingSphere(new THREE.Sphere()));
                  r0 = R * 1.9;
                  r1 = R * 7;
                  y0 = center.y;
                  y1 = center.y - R * 0.05;
                  rIntro = R * 2;
                  yIntro = center.y + R * 0.8;
                  if (g.animations[0]) {
                    mixer = new THREE.AnimationMixer(g.scene);
                    act = mixer.clipAction(g.animations[0]);
                    act.setLoop(THREE.LoopOnce, 0);
                    act.clampWhenFinished = true;
                    act.play();
                    clip = g.animations[0].duration;
                  }
                  res();
                },
                undefined,
                rej
              )
            );
            break;
          } catch {}
        }
        // Démarrer l'animation après le chargement du modèle
        anim();
      })();

      /* ===== INTERACTION ===== */
      let prog = 0;
      addEventListener(
        "scroll",
        (e) => {
          const m = document.body.scrollHeight - innerHeight;
          prog = C(scrollY / m);
          lastScrollTime = Date.now(); // Mettre à jour le temps du dernier défilement
          hasScrolled = true; // Marquer que l'utilisateur a défilé
        },
        { passive: true }
      );
      addEventListener("resize", () => {
        // Recalculer si nous sommes sur un grand écran à chaque redimensionnement
        const newIsLargeScreen = window.innerWidth > 1440;

        // Adapter le pixel ratio en fonction de la nouvelle taille
        const newMaxPixelRatio = newIsLargeScreen
          ? Math.min(window.devicePixelRatio, 2)
          : Math.min(window.devicePixelRatio, 1.5);

        renderer.setPixelRatio(newMaxPixelRatio);
        renderer.setSize(innerWidth, innerHeight);
        camera.aspect = innerWidth / innerHeight;
        camera.updateProjectionMatrix();

        // Mettre à jour les optimisations en fonction de la nouvelle taille
        if (newIsLargeScreen !== isLargeScreen) {
          renderer.shadowMap.enabled = newIsLargeScreen;
          renderer.shadowMap.type = newIsLargeScreen
            ? THREE.PCFSoftShadowMap
            : THREE.BasicShadowMap;
        }

        // Mettre à jour la valeur de slideRight.amount en fonction de la nouvelle taille d'écran
        CFG.slideRight.amount = calculateSlideAmount();

        // Si on est dans la phase où le déplacement est appliqué, recalculer la position immédiatement
        if (prog >= CFG.intro) {
          const t = (prog - CFG.intro) / (1 - CFG.intro);
          if (t >= CFG.slideRight.start) {
            if (t <= CFG.slideRight.end) {
              // Recalculer le pourcentage de progression du déplacement
              const slideProgress = C(
                (t - CFG.slideRight.start) /
                  (CFG.slideRight.end - CFG.slideRight.start)
              );
              document.getElementById("webgl").style.marginLeft = `${
                slideProgress * CFG.slideRight.amount
              }%`;
            } else {
              // Si on est après la fin du déplacement, appliquer la valeur complète
              document.getElementById(
                "webgl"
              ).style.marginLeft = `${CFG.slideRight.amount}%`;
            }
          }
        }
      });

      /* captions */
      const caps = [cap0, cap1, cap2, cap3, cap4, cap5];
      const showCaps = (t) =>
        caps.forEach((el, i) => {
          const a = i * CFG.legend.seg,
            b = a + CFG.legend.seg;
          let o = 0;
          if (t >= a - CFG.legend.fade && t <= b + CFG.legend.fade)
            o =
              t < a
                ? (t - (a - CFG.legend.fade)) / CFG.legend.fade
                : t > b
                ? 1 - (t - b) / CFG.legend.fade
                : 1;
          el.style.opacity = o;
        });

      /* ===== LOOP ===== */
      const OFFSET = Math.PI * 0.5; // Changé de Math.PI à Math.PI * 0.5 pour une vue plus frontale
      // Variables pour contrôler l'animation
      let animationActive = true;
      let animFrameId;
      let autoRotationAngle = OFFSET;
      let lastScrollTime = 0; // Initialisé à 0 pour que la rotation démarre immédiatement
      let hasScrolled = false; // Pour suivre si l'utilisateur a déjà défilé
      const AUTO_ROTATION_SPEED = 0.005; // Vitesse de rotation automatique
      const SCROLL_TIMEOUT = 1000; // Temps d'inactivité avant reprise de la rotation auto (en ms)

      // Fonction d'animation
      function anim() {
        if (!animationActive) return;
        animFrameId = requestAnimationFrame(anim);

        if (!R) return;

        // Rotation automatique dans la phase d'intro si l'utilisateur n'a jamais défilé ou s'il n'y a pas eu d'activité récente
        if (
          prog < CFG.intro &&
          (!hasScrolled || Date.now() - lastScrollTime > SCROLL_TIMEOUT)
        ) {
          autoRotationAngle += AUTO_ROTATION_SPEED;
        }

        if (prog < CFG.intro) {
          const k = prog / CFG.intro;
          const r = L(rIntro, r0, k),
            y = L(yIntro, y0, k);
          camera.position.set(
            center.x + Math.cos(autoRotationAngle) * r,
            y,
            center.z + Math.sin(autoRotationAngle) * r
          );
          camera.lookAt(center);
          caps.forEach((e) => (e.style.opacity = 0));
          cta.style.opacity = 0;
          // Afficher le titre ALTO LILLE dès le début
          document.getElementById("brand-title").style.opacity = 1;
          // Afficher l'indicateur de défilement dans la phase d'intro avec animation
          const scrollIndicatorEl = document.getElementById("scroll-indicator");
          scrollIndicatorEl.classList.add("visible");
          // Afficher les polaroids
          document
            .querySelectorAll(".polaroid")
            .forEach((p) => (p.style.opacity = 1));
          if (act) {
            act.time = clip - k * (clip - Math.min(5.2, clip));
            mixer.update(0);
          }
        } else {
          const t = (prog - CFG.intro) / (1 - CFG.intro),
            rot = C(t / CFG.rotEnd),
            ang = OFFSET - rot * Math.PI * 2;
          const r = L(r0, r1, t);
          let y = L(y0, y1, t);
          const { travelAmp: a } = CFG;
          y +=
            t <= 0.3
              ? a * R * C((t - 0.15) / 0.15)
              : t < 0.55
              ? a * R * C((0.55 - t) / 0.25) * 0.7
              : 0;
          camera.position.set(
            center.x + Math.cos(ang) * r,
            y,
            center.z + Math.sin(ang) * r
          );
          camera.lookAt(center.x, center.y - R * 0.15, center.z);
          showCaps(t);
          // Faire disparaître le titre ALTO LILLE progressivement au début de la transition
          const titleOpacity = t < 0.1 ? 1 - t * 10 : 0;
          document.getElementById("brand-title").style.opacity = titleOpacity;
          // Masquer l'indicateur de défilement dès que l'utilisateur commence à défiler
          const scrollIndicatorEl = document.getElementById("scroll-indicator");
          scrollIndicatorEl.classList.remove("visible");
          // Faire disparaître les polaroids avant que "PLA éco-responsable" n'apparaisse
          // La première légende apparaît à t = 0.04 (CFG.legend.fade)
          const firstCaptionStart = CFG.legend.fade; // 0.04
          const polaroidOpacity =
            t < firstCaptionStart ? 1 - t / firstCaptionStart : 0;
          document
            .querySelectorAll(".polaroid")
            .forEach((p) => (p.style.opacity = polaroidOpacity));
          cta.style.opacity = t > 0.95 ? C((t - 0.95) / 0.05) : 0;
          act &&
            ((act.time = Math.min(t * CFG.timeScale, 1) * clip),
            mixer.update(0));

          // Déplacer le canvas vers la droite lorsque "emballage éco-responsable" commence à disparaître
          const { slideRight } = CFG;
          if (t >= slideRight.start && t <= slideRight.end) {
            // Calcul du pourcentage de déplacement entre 0 et 1
            const slideProgress = C(
              (t - slideRight.start) / (slideRight.end - slideRight.start)
            );
            // Application du margin-left en pourcentage
            document.getElementById("webgl").style.marginLeft = `${
              slideProgress * slideRight.amount
            }%`;
          } else if (t < slideRight.start) {
            // S'assurer que le canvas est à sa position initiale avant le début du déplacement
            document.getElementById("webgl").style.marginLeft = "0";
          } else if (t > slideRight.end) {
            // S'assurer que le canvas est complètement déplacé après la fin du déplacement
            document.getElementById(
              "webgl"
            ).style.marginLeft = `${slideRight.amount}%`;
          }
        }
        renderer.render(scene, camera);
      }

      /* ===== NAVIGATION ===== */
      document.getElementById("cta").addEventListener("click", function () {
        navigateToShop();
      });

      // Gestion de la navigation
      function navigateToShop() {
        // Mettre à jour l'URL
        history.pushState({}, "", "/shop");
        // Arrêter l'animation Three.js
        animationActive = false;
        if (animFrameId) {
          cancelAnimationFrame(animFrameId);
          animFrameId = null;
        }
        // Afficher l'app React et masquer la landing
        document.getElementById("landing-container").style.display = "none";
        document.getElementById("root").style.display = "block";
        // Notifier l'app React du changement
        window.dispatchEvent(
          new CustomEvent("routeChange", { detail: { path: "/shop" } })
        );
      }

      function handleNavigation() {
        // Vérifier l'URL actuelle
        const path = window.location.pathname;
        if (path === "/" || path === "") {
          // Afficher la landing sur la page d'accueil uniquement
          document.getElementById("landing-container").style.display = "block";
          document.getElementById("root").style.display = "none";

          // Redémarrer l'animation Three.js
          animationActive = true;
          // Réinitialiser la position de défilement
          window.scrollTo(0, 0);
          // Redémarrer toujours l'animation pour s'assurer qu'elle fonctionne
          if (animFrameId) {
            cancelAnimationFrame(animFrameId); // Annuler l'animation précédente si elle existait
          }
          animFrameId = requestAnimationFrame(anim); // Relancer une nouvelle boucle d'animation
        } else {
          // Afficher l'app React pour TOUS les autres chemins (sans exception)
          document.getElementById("landing-container").style.display = "none";
          document.getElementById("root").style.display = "block";

          // Arrêter l'animation Three.js complètement
          animationActive = false;
          if (animFrameId) {
            cancelAnimationFrame(animFrameId);
            animFrameId = null;
          }
        }
      }

      // Écouter les changements d'URL
      window.addEventListener("popstate", handleNavigation);

      // Écouter l'événement personnalisé de retour à la landing page depuis l'app React
      window.addEventListener("returnToLanding", function () {
        // Réinitialiser les variables d'animation
        prog = 0;
        animationActive = true;

        // Annuler l'animation précédente si elle existait
        if (animFrameId) {
          cancelAnimationFrame(animFrameId);
          animFrameId = null;
        }

        // Relancer une nouvelle boucle d'animation
        animFrameId = requestAnimationFrame(anim);
      });

      // Gestion du thème sombre/clair
      const themeToggle = document.getElementById("theme-toggle");
      const themeLabel = document.getElementById("theme-label");

      // Vérifier le mode préféré de l'utilisateur ou le mode stocké
      const prefersDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      const savedTheme = localStorage.getItem("theme");

      // Appliquer le thème initial
      if (savedTheme === "dark" || (!savedTheme && prefersDarkMode)) {
        document.body.classList.add("dark-mode");
        themeToggle.checked = true;
        themeLabel.textContent = "Sombre";
        // Mettre à jour la couleur du renderer si déjà défini
        if (typeof renderer !== "undefined") {
          renderer.setClearColor("#000000", 1);
        }
      } else {
        themeLabel.textContent = "Clair";
      }

      // Écouter les changements de thème
      themeToggle.addEventListener("change", function () {
        if (this.checked) {
          document.body.classList.add("dark-mode");
          localStorage.setItem("theme", "dark");
          themeLabel.textContent = "Sombre";
          // Mettre à jour la couleur de fond du renderer pour le mode sombre
          renderer.setClearColor("#000000", 1);
        } else {
          document.body.classList.remove("dark-mode");
          localStorage.setItem("theme", "light");
          themeLabel.textContent = "Clair";
          // Mettre à jour la couleur de fond du renderer pour le mode clair
          renderer.setClearColor(CFG.colours.bg, 1);
        }
      });

      // Gestion du changement de langue
      const langToggle = document.getElementById("lang-toggle");
      const langLabel = document.getElementById("lang-label");

      // Objets de traduction (français et anglais)
      const translations = {
        fr: {
          cap0: "PLA éco‑responsable",
          cap1: "Montage ultra simple",
          cap2: "Chêne écogéré",
          cap3: "Conçu & fabriqué par Alto Lille en France",
          cap4: "LED 60 W E14 incluse",
          cap5: "Emballage éco‑responsable",
          cta: "Visiter la boutique",
          theme: "Clair",
          themeDark: "Sombre",
          scroll: "Produit disponible à la vente",
          scrollAction: "Scroll vers le bas !",
          footer: "© 2025 Alto Lille - Tous droits réservés",
        },
        en: {
          cap0: "Eco-friendly PLA",
          cap1: "Ultra simple assembly",
          cap2: "Sustainable oak",
          cap3: "Designed & made by Alto Lille in France",
          cap4: "60W E14 LED bulb included",
          cap5: "Eco-responsible packaging",
          cta: "Visit the shop",
          theme: "Light",
          themeDark: "Dark",
          scroll: "Product available for purchase",
          scrollAction: "Scroll down!",
          footer: "© 2025 Alto Lille - All rights reserved",
        },
      };

      // Vérifier la langue stockée
      const savedLang = localStorage.getItem("lang") || "fr";

      // Appliquer la langue initiale
      if (savedLang === "en") {
        langToggle.checked = true;
        langLabel.textContent = "EN";
        applyLanguage("en");
      } else {
        langLabel.textContent = "FR";
      }

      // ===== FONCTIONNALITÉ INTERACTIVE POUR L'INDICATEUR DE DÉFILEMENT =====

      // Ajouter l'interactivité à l'indicateur de défilement
      const scrollIndicator = document.getElementById("scroll-indicator");
      const scrollIcon = document.getElementById("scroll-icon");

      if (scrollIndicator && scrollIcon) {
        // Faire de l'indicateur un élément cliquable
        scrollIndicator.style.cursor = "pointer";
        scrollIndicator.style.pointerEvents = "auto";

        // Fonction de scroll fluide vers le début du contenu
        function smoothScrollToContent() {
          // Calculer la position de scroll pour commencer l'animation
          const scrollPosition = window.innerHeight * 0.15; // 15% de la hauteur de l'écran

          window.scrollTo({
            top: scrollPosition,
            behavior: "smooth",
          });

          // Ajouter un effet visuel de clic
          scrollIcon.style.transform = "scale(0.9)";
          setTimeout(() => {
            scrollIcon.style.transform = "scale(1)";
          }, 150);
        }

        // Ajouter les événements de clic
        scrollIndicator.addEventListener("click", smoothScrollToContent);
        scrollIcon.addEventListener("click", (e) => {
          e.stopPropagation(); // Éviter la double exécution
          smoothScrollToContent();
        });

        // Ajouter le support du clavier pour l'accessibilité
        scrollIndicator.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            smoothScrollToContent();
          }
        });

        // Ajouter un attribut tabindex pour la navigation au clavier
        scrollIndicator.setAttribute("tabindex", "0");
        scrollIndicator.setAttribute("role", "button");
        scrollIndicator.setAttribute(
          "aria-label",
          "Défiler vers le bas pour découvrir le produit"
        );

        // Effet hover amélioré avec JavaScript
        scrollIndicator.addEventListener("mouseenter", () => {
          scrollIndicator.style.transform = "translateX(-50%) translateY(-5px)";
        });

        scrollIndicator.addEventListener("mouseleave", () => {
          scrollIndicator.style.transform = "translateX(-50%) translateY(0)";
        });
      }

      // Fonction pour appliquer une langue
      function applyLanguage(lang) {
        const t = translations[lang];
        document.getElementById("cap0").textContent = t.cap0;
        document.getElementById("cap1").textContent = t.cap1;
        document.getElementById("cap2").textContent = t.cap2;
        document.getElementById("cap3").textContent = t.cap3;
        document.getElementById("cap4").textContent = t.cap4;
        document.getElementById("cap5").textContent = t.cap5;
        document.getElementById("cta").textContent = t.cta;
        document.getElementById("scroll-message").textContent = t.scroll;
        document.querySelector("#scroll-icon .scroll-action").textContent =
          t.scrollAction;
        document.querySelector("footer").textContent = t.footer;

        // Mettre à jour les libellés des toggles en fonction de la langue
        if (themeToggle.checked) {
          themeLabel.textContent = t.themeDark;
        } else {
          themeLabel.textContent = t.theme;
        }
      }

      // Écouter les changements de langue
      langToggle.addEventListener("change", function () {
        if (this.checked) {
          langLabel.textContent = "EN";
          localStorage.setItem("lang", "en");
          applyLanguage("en");
        } else {
          langLabel.textContent = "FR";
          localStorage.setItem("lang", "fr");
          applyLanguage("fr");
        }
      });

      // Exécuter au chargement initial
      document.addEventListener("DOMContentLoaded", function () {
        handleNavigation();
      });

      // S'assurer que la page est correctement initialisée immédiatement (sans attendre les événements)
      handleNavigation();

      /* ===== EFFET DE PARALLAXE POUR LES POLAROIDS ===== */
      // Déclarer les variables pour l'effet de parallaxe
      let mouseX = 0;
      let mouseY = 0;
      let targetX = 0;
      let targetY = 0;
      let windowHalfX = window.innerWidth / 2;
      let windowHalfY = window.innerHeight / 2;
      const polaroids = document.querySelectorAll(".polaroid");

      // Variables pour gérer le délai avant la navigation
      let navigationTimeout = null;
      let isFlipping = false;
      let parallaxEnabled = true;

      // Stocker les positions parallax de chaque polaroid
      const parallaxPositions = new Map();

      // Définir des facteurs de force différents pour chaque polaroid (plus la valeur est élevée, plus l'effet est prononcé)
      const parallaxIntensity = [
        0.12, // p1 - augmenté pour plus de visibilité
        0.08, // p2
        0.15, // p3
        0.1, // p4
        0.09, // p5
        0.13, // p6
      ];

      // Configuration du facteur de lissage (plus la valeur est basse, plus le mouvement est fluide)
      const smoothFactor = 0.06; // Plus fluide

      // Fonction pour appliquer ou préserver les transformations parallax
      function applyParallaxTransform(polaroid, moveX, moveY) {
        // Récupérer la rotation de base du polaroid
        const rotation =
          getComputedStyle(polaroid).getPropertyValue("--rotation") || "0deg";

        // Appliquer le parallax ET maintenir la rotation de base
        const transform = `translate(${moveX}px, ${moveY}px) rotate(${rotation})`;
        polaroid.style.transform = transform;

        // Stocker la position pour la réutiliser si nécessaire
        const index = Array.from(polaroids).indexOf(polaroid);
        parallaxPositions.set(polaroid, {
          x: moveX,
          y: moveY,
          rotation: rotation,
        });
      }

      // Fonction pour réappliquer le parallax sur un élément
      function reapplyParallax(polaroid) {
        const position = parallaxPositions.get(polaroid);
        if (position && parallaxEnabled) {
          const transform = `translate(${position.x}px, ${position.y}px) rotate(${position.rotation})`;
          polaroid.style.transform = transform;
        }
      }

      // Vérifier les capacités tactiles dès le début
      const isTouch = isTouchDevice();
      parallaxEnabled = !isTouch;

      // Écouter les mouvements de la souris
      document.addEventListener(
        "mousemove",
        function (e) {
          if (!parallaxEnabled) return;

          // Calculer la position relative de la souris par rapport au centre de l'écran
          targetX = e.clientX - windowHalfX;
          targetY = e.clientY - windowHalfY;
        },
        { passive: true }
      );

      // Animation fluide avec requestAnimationFrame
      function updateParallax() {
        if (parallaxEnabled && !isTouch) {
          // Interpolation fluide entre la position actuelle et la position cible
          mouseX += (targetX - mouseX) * smoothFactor;
          mouseY += (targetY - mouseY) * smoothFactor;

          // Appliquer l'effet de parallaxe à chaque polaroid avec une intensité différente
          polaroids.forEach((polaroid, index) => {
            const computedStyle = window.getComputedStyle(polaroid);
            const opacity = parseFloat(computedStyle.opacity);

            if (opacity > 0.1 && !polaroid.classList.contains("flipping")) {
              // N'appliquer l'effet que si le polaroid est visible et n'est pas en train de se retourner
              const intensity = parallaxIntensity[index] || 0.07;
              const moveX = mouseX * intensity;
              const moveY = mouseY * intensity;

              // Appliquer la translation au polaroid lui-même
              applyParallaxTransform(polaroid, moveX, moveY);
            }
          });
        }

        // Continuer l'animation
        requestAnimationFrame(updateParallax);
      }

      // Démarrer l'animation de parallaxe
      setTimeout(() => {
        // Initialiser les rotations de base pour tous les polaroids
        polaroids.forEach((polaroid) => {
          const rotation =
            getComputedStyle(polaroid).getPropertyValue("--rotation") || "0deg";
          if (!polaroid.style.transform || polaroid.style.transform === "") {
            polaroid.style.transform = `rotate(${rotation})`;
          }
        });

        requestAnimationFrame(updateParallax);
      }, 1000); // Attendre 1 seconde pour laisser la page se charger

      // Mettre à jour les dimensions lors du redimensionnement de la fenêtre
      window.addEventListener(
        "resize",
        function () {
          windowHalfX = window.innerWidth / 2;
          windowHalfY = window.innerHeight / 2;
        },
        { passive: true }
      );

      // Fonction pour réinitialiser la position des polaroids quand la souris quitte la fenêtre
      document.addEventListener("mouseleave", function () {
        if (parallaxEnabled) {
          polaroids.forEach((polaroid) => {
            // Remettre seulement la rotation de base, sans parallax
            const rotation =
              getComputedStyle(polaroid).getPropertyValue("--rotation") ||
              "0deg";
            polaroid.style.transform = `rotate(${rotation})`;
            parallaxPositions.delete(polaroid);
          });
        }
      });

      // Fonction pour détecter les capacités tactiles réelles (pas la taille d'écran)
      function isTouchDevice() {
        // Combinaison de plusieurs méthodes de détection pour plus de précision
        const hasTouch =
          "ontouchstart" in window ||
          navigator.maxTouchPoints > 0 ||
          navigator.msMaxTouchPoints > 0;

        // Détection via les media queries (plus fiable)
        const hasCoarsePointer =
          window.matchMedia && window.matchMedia("(pointer: coarse)").matches;
        const canHover =
          window.matchMedia && window.matchMedia("(hover: hover)").matches;

        // Un appareil tactile a généralement un pointer coarse et ne peut pas vraiment hover
        return hasTouch || (hasCoarsePointer && !canHover);
      }

      // Fonction pour initialiser les classes CSS basées sur la détection tactile
      function initTouchClasses() {
        const body = document.body;

        if (isTouchDevice()) {
          body.classList.add("touch-device");
          body.classList.remove("non-touch-device");
        } else {
          body.classList.add("non-touch-device");
          body.classList.remove("touch-device");
        }
      }

      // Initialiser immédiatement les classes tactiles
      initTouchClasses();

      // Fonction de compatibilité pour l'ancien nom (sera progressivement remplacée)
      function isMobileDevice() {
        return isTouchDevice();
      }

      // Fonction pour annoncer les changements aux lecteurs d'écran
      function announceToScreenReader(message) {
        // Créer une région live pour les annonces
        let liveRegion = document.getElementById("polaroid-announcer");
        if (!liveRegion) {
          liveRegion = document.createElement("div");
          liveRegion.id = "polaroid-announcer";
          liveRegion.setAttribute("aria-live", "polite");
          liveRegion.setAttribute("aria-atomic", "true");
          liveRegion.style.position = "absolute";
          liveRegion.style.left = "-10000px";
          liveRegion.style.width = "1px";
          liveRegion.style.height = "1px";
          liveRegion.style.overflow = "hidden";
          document.body.appendChild(liveRegion);
        }

        liveRegion.textContent = message;

        // Nettoyer après l'annonce
        setTimeout(() => {
          liveRegion.textContent = "";
        }, 1000);
      }

      // Fonction pour retourner un polaroid
      function flipPolaroid(polaroid, inner, rotation) {
        const isAlreadyFlipped =
          inner.style.transform.includes("rotateY(180deg)");

        if (!isAlreadyFlipped) {
          // Ajouter une classe pour empêcher temporairement le parallax
          polaroid.classList.add("flipping");

          // Retourner le polaroid
          inner.style.transform = `rotate(${rotation}) rotateY(180deg)`;
          polaroid.classList.add("flipped");
          polaroid.setAttribute("aria-expanded", "true");

          // Retirer la classe flipping après l'animation
          setTimeout(() => {
            polaroid.classList.remove("flipping");
            // Réappliquer le parallax si nécessaire
            reapplyParallax(polaroid);
          }, 600); // Durée de l'animation de flip

          // Annoncer le changement
          const title = polaroid.getAttribute("data-title") || "Polaroid";
          announceToScreenReader(
            `${title} retourné. Appuyez à nouveau pour naviguer.`
          );

          // Animation de succès
          inner.classList.add("loading");
          setTimeout(() => {
            inner.classList.remove("loading");
          }, 300);

          return true; // Polaroid a été retourné
        }

        return false; // Polaroid était déjà retourné
      }

      // Fonction pour remettre un polaroid en position normale (face avant)
      function flipPolaroidBack(polaroid, inner, rotation) {
        const isFlipped = inner.style.transform.includes("rotateY(180deg)");

        if (isFlipped) {
          // Remettre le polaroid en position normale
          inner.style.transform = `rotate(${rotation})`;
          polaroid.classList.remove("flipped");
          polaroid.setAttribute("aria-expanded", "false");

          // Annoncer le changement
          const title = polaroid.getAttribute("data-title") || "Polaroid";
          announceToScreenReader(`${title} remis en position normale.`);

          // Animation de succès
          inner.classList.add("loading");
          setTimeout(() => {
            inner.classList.remove("loading");
          }, 300);

          return true; // Polaroid a été remis en position normale
        }

        return false; // Polaroid était déjà en position normale
      }

      // Fonction pour naviguer vers un lien
      function navigateToLink(polaroid, link) {
        if (link) {
          const title = polaroid.getAttribute("data-title") || "Page";
          announceToScreenReader(`Navigation vers ${title}`);

          // Animation de navigation
          const inner = polaroid.querySelector(".polaroid-inner");
          inner.style.transition = "transform 0.3s ease";
          inner.style.transform = inner.style.transform + " scale(0.95)";

          setTimeout(() => {
            window.location.href = link;
          }, 150);
        }
      }

      // Ajouter les interactions pour les polaroids
      polaroids.forEach((polaroid) => {
        const link = polaroid.getAttribute("data-link");
        const inner = polaroid.querySelector(".polaroid-inner");
        const rotation =
          getComputedStyle(polaroid).getPropertyValue("--rotation") || "0deg";

        // Gestion des événements tactiles pour les appareils mobiles
        polaroid.addEventListener("touchstart", function (e) {
          e.preventDefault();

          if (isFlipping) return;

          // Vérifier si on touche le bouton d'action "explore"
          // Correction spécifique pour p5 : vérifier aussi dans l'élément parent
          let touchedActionButton =
            e.target && e.target.closest(".polaroid-action");

          // Correction supplémentaire pour p5 en cas de problème de propagation d'événement
          if (!touchedActionButton && polaroid.classList.contains("p5")) {
            const actionButton = polaroid.querySelector(".polaroid-action");
            if (actionButton && e.target === actionButton) {
              touchedActionButton = actionButton;
            }
          }

          const isFlipped = inner.style.transform.includes("rotateY(180deg)");

          if (isFlipped) {
            if (touchedActionButton) {
              // Si on touche le bouton "explore", naviguer vers le lien
              navigateToLink(polaroid, link);
            } else {
              // Si on touche ailleurs sur le polaroid retourné, le fermer
              isFlipping = true;
              flipPolaroidBack(polaroid, inner, rotation);

              setTimeout(() => {
                isFlipping = false;
              }, 600);
            }
          } else {
            isFlipping = true;
            flipPolaroid(polaroid, inner, rotation);

            setTimeout(() => {
              isFlipping = false;
            }, 600);
          }
        });

        // Gestion des clics pour les ordinateurs de bureau et les événements clavier
        function handlePolaroidActivation(e) {
          // Vérifier si c'est un événement clavier et si c'est la bonne touche
          if (e.type === "keydown" && e.key !== "Enter" && e.key !== " ") {
            return;
          }

          // Empêcher l'action par défaut pour les touches
          if (e.type === "keydown") {
            e.preventDefault();
          }

          // Si l'appareil est mobile et que c'est un clic, laisser touchstart gérer
          if (isTouchDevice() && e.type === "click") return;

          if (isFlipping) return;

          // Vérifier si on clique sur le bouton d'action "explore"
          // Correction spécifique pour p5 : vérifier aussi dans l'élément parent
          let clickedOnActionButton =
            e.target && e.target.closest(".polaroid-action");

          // Correction supplémentaire pour p5 en cas de problème de propagation d'événement
          if (!clickedOnActionButton && polaroid.classList.contains("p5")) {
            const actionButton = polaroid.querySelector(".polaroid-action");
            if (
              actionButton &&
              (e.target === actionButton || actionButton.contains(e.target))
            ) {
              clickedOnActionButton = actionButton;
            }
          }

          const isFlipped = inner.style.transform.includes("rotateY(180deg)");

          if (isFlipped) {
            if (clickedOnActionButton) {
              // Si on clique sur le bouton "explore", naviguer vers le lien
              navigateToLink(polaroid, link);
            } else {
              // Si on clique ailleurs sur le polaroid retourné, le fermer
              isFlipping = true;
              flipPolaroidBack(polaroid, inner, rotation);

              setTimeout(() => {
                isFlipping = false;
              }, 600);
            }
          } else {
            // Sur desktop, retourner le polaroid seulement si on clique/appuie sur une touche
            if (e.type === "click" || e.type === "keydown") {
              isFlipping = true;
              flipPolaroid(polaroid, inner, rotation);

              setTimeout(() => {
                isFlipping = false;
              }, 600);
            }
          }
        }

        // Ajouter les événements pour clic et clavier
        polaroid.addEventListener("click", handlePolaroidActivation);
        polaroid.addEventListener("keydown", handlePolaroidActivation);

        // Gestion des clics ET effet de survol bonus pour desktop
        polaroid.addEventListener("mouseenter", function () {
          // Les boutons restent TOUJOURS visibles - juste un effet bonus sur desktop
          if (!isFlipping && !polaroid.classList.contains("flipped")) {
            // Effet de survol léger sans retourner complètement
            inner.style.transform =
              inner.style.transform.replace("rotateY(180deg)", "") +
              " rotateY(15deg)";

            // Effet bonus : légère mise en évidence du bouton (mais il reste visible)
            const action = polaroid.querySelector(".polaroid-action");
            if (action) {
              action.style.setProperty("transform", "scale(1.05)", "important");
              action.style.setProperty(
                "box-shadow",
                "0 4px 8px rgba(0,0,0,0.3)",
                "important"
              );
            }
          }
        });

        polaroid.addEventListener("mouseleave", function () {
          // Les boutons restent TOUJOURS visibles - retour à l'état normal
          if (!polaroid.classList.contains("flipped")) {
            // Remettre à la position normale
            inner.style.transform = `rotate(${rotation})`;

            // Retour à l'état normal du bouton (mais il reste visible)
            const action = polaroid.querySelector(".polaroid-action");
            if (action) {
              action.style.setProperty("transform", "scale(1)", "important");
              action.style.setProperty("box-shadow", "none", "important");
            }
          }
        });

        // Gestion du focus pour l'accessibilité (pas de retournement automatique)
        polaroid.addEventListener("focus", function () {
          // Focus complètement supprimé pour éviter les cadres blancs
          // L'accessibilité est maintenue par les attributs ARIA
        });

        polaroid.addEventListener("blur", function () {
          // Focus complètement supprimé pour éviter les cadres blancs
          // L'accessibilité est maintenue par les attributs ARIA
        });
      });
    </script>
    <script>
      // Script d'initialisation des polaroids
      document.addEventListener("DOMContentLoaded", function () {
        const polaroids = document.querySelectorAll(".polaroid");

        // SOLUTION UNIVERSELLE : Boutons visibles sur TOUS les appareils
        function ensureActionButtonsVisible() {
          // Plus de conditions restrictives - application universelle !
          polaroids.forEach((polaroid) => {
            const actionButtons = polaroid.querySelectorAll(".polaroid-action");

            actionButtons.forEach((actionButton) => {
              // FORCER les styles sur TOUS les appareils
              actionButton.style.setProperty("opacity", "1", "important");
              actionButton.style.setProperty("display", "block", "important");
              actionButton.style.setProperty(
                "visibility",
                "visible",
                "important"
              );
              actionButton.style.setProperty(
                "pointer-events",
                "auto",
                "important"
              );
              actionButton.style.setProperty(
                "position",
                "relative",
                "important"
              );
              actionButton.style.setProperty("z-index", "999", "important");

              // Marquer comme forcé universellement
              actionButton.setAttribute("data-universal-visible", "true");
            });
          });
        }

        // OPTIMISATION SPÉCIALE pour très petits écrans (≤320px)
        function optimizeForSmallScreens() {
          if (window.innerWidth <= 320) {
            // Optimisation des polaroids pour 320px
            polaroids.forEach((polaroid) => {
              // Forcer les dimensions réduites
              polaroid.style.setProperty("width", "140px", "important");
              polaroid.style.setProperty("height", "180px", "important");
              polaroid.style.setProperty("margin", "3px", "important");

              const inner = polaroid.querySelector(".polaroid-inner");
              if (inner) {
                inner.style.setProperty("width", "136px", "important");
                inner.style.setProperty("height", "176px", "important");
              }

              // Optimiser le verso pour le centrage parfait
              const back = polaroid.querySelector(".polaroid-back");
              if (back) {
                back.style.setProperty("display", "flex", "important");
                back.style.setProperty("flex-direction", "column", "important");
                back.style.setProperty(
                  "justify-content",
                  "center",
                  "important"
                );
                back.style.setProperty("align-items", "center", "important");
                back.style.setProperty("text-align", "center", "important");
                back.style.setProperty("padding", "6px", "important");
                back.style.setProperty("box-sizing", "border-box", "important");
              }

              // Optimiser les boutons d'action avec centrage parfait
              const actionButtons =
                polaroid.querySelectorAll(".polaroid-action");
              actionButtons.forEach((actionButton) => {
                actionButton.style.setProperty("font-size", "9px", "important");
                actionButton.style.setProperty(
                  "padding",
                  "5px 8px",
                  "important"
                );
                actionButton.style.setProperty(
                  "min-height",
                  "26px",
                  "important"
                );
                actionButton.style.setProperty(
                  "min-width",
                  "55px",
                  "important"
                );
                actionButton.style.setProperty(
                  "max-width",
                  "115px",
                  "important"
                );
                actionButton.style.setProperty(
                  "margin",
                  "4px auto 0 auto",
                  "important"
                );
                actionButton.style.setProperty(
                  "border-radius",
                  "3px",
                  "important"
                );
                actionButton.style.setProperty(
                  "line-height",
                  "1.2",
                  "important"
                );
                actionButton.style.setProperty("display", "flex", "important");
                actionButton.style.setProperty(
                  "align-items",
                  "center",
                  "important"
                );
                actionButton.style.setProperty(
                  "justify-content",
                  "center",
                  "important"
                );
                actionButton.style.setProperty(
                  "text-align",
                  "center",
                  "important"
                );
                actionButton.style.setProperty(
                  "background",
                  "rgba(0, 0, 0, 0.8)",
                  "important"
                );
                actionButton.style.setProperty("color", "white", "important");
                actionButton.style.setProperty(
                  "border",
                  "1px solid rgba(255, 255, 255, 0.3)",
                  "important"
                );
                actionButton.style.setProperty(
                  "font-weight",
                  "500",
                  "important"
                );
                actionButton.style.setProperty(
                  "letter-spacing",
                  "0.3px",
                  "important"
                );
              });

              // Optimiser le texte avec centrage parfait
              const title = polaroid.querySelector(".polaroid-title");
              if (title) {
                title.style.setProperty("font-size", "11px", "important");
                title.style.setProperty("line-height", "1.2", "important");
                title.style.setProperty("margin-bottom", "3px", "important");
                title.style.setProperty("max-height", "2.4em", "important");
                title.style.setProperty("text-align", "center", "important");
                title.style.setProperty("width", "100%", "important");
                title.style.setProperty("display", "block", "important");
              }

              const description = polaroid.querySelector(
                ".polaroid-description"
              );
              if (description) {
                description.style.setProperty("font-size", "9px", "important");
                description.style.setProperty(
                  "line-height",
                  "1.3",
                  "important"
                );
                description.style.setProperty(
                  "margin-bottom",
                  "4px",
                  "important"
                );
                description.style.setProperty(
                  "max-height",
                  "2.6em",
                  "important"
                );
                description.style.setProperty(
                  "text-align",
                  "center",
                  "important"
                );
                description.style.setProperty("width", "100%", "important");
                description.style.setProperty("display", "block", "important");
              }
            });

            // Optimiser l'encart du bas
            const scrollContent = document.querySelector(".scroll-content");
            if (scrollContent) {
              scrollContent.style.setProperty("width", "280px", "important");
              scrollContent.style.setProperty(
                "max-width",
                "calc(100vw - 20px)",
                "important"
              );
              scrollContent.style.setProperty("padding", "8px", "important");
              scrollContent.style.setProperty("left", "50%", "important");
              scrollContent.style.setProperty(
                "transform",
                "translateX(-50%)",
                "important"
              );
            }

            const productName = document.querySelector(".product-name");
            if (productName) {
              productName.style.setProperty("font-size", "14px", "important");
            }

            const cta = document.getElementById("cta");
            if (cta) {
              cta.style.setProperty("font-size", "10px", "important");
              cta.style.setProperty("padding", "8px 12px", "important");
              cta.style.setProperty("max-width", "200px", "important");
            }
          }
        }

        // Fonction de vérification périodique UNIVERSELLE
        function periodicCheck() {
          // Plus de conditions - vérification pour TOUS les appareils
          polaroids.forEach((polaroid) => {
            const actionButtons = polaroid.querySelectorAll(".polaroid-action");

            actionButtons.forEach((actionButton) => {
              const currentOpacity =
                window.getComputedStyle(actionButton).opacity;
              const currentDisplay =
                window.getComputedStyle(actionButton).display;
              const currentVisibility =
                window.getComputedStyle(actionButton).visibility;

              // Forcer IMMÉDIATEMENT si pas correct sur TOUS les appareils
              if (
                parseFloat(currentOpacity) < 1 ||
                currentDisplay === "none" ||
                currentVisibility === "hidden"
              ) {
                actionButton.style.setProperty("opacity", "1", "important");
                actionButton.style.setProperty("display", "block", "important");
                actionButton.style.setProperty(
                  "visibility",
                  "visible",
                  "important"
                );
                actionButton.style.setProperty(
                  "pointer-events",
                  "auto",
                  "important"
                );
              }
            });
          });
        }

        // Fonction d'observation pour maintenir la visibilité UNIVERSELLE
        function setupButtonObserver() {
          // Application pour TOUS les appareils
          polaroids.forEach((polaroid) => {
            const actionButtons = polaroid.querySelectorAll(".polaroid-action");

            actionButtons.forEach((actionButton) => {
              // Observer les changements de style sur tous appareils
              const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                  if (
                    mutation.type === "attributes" &&
                    mutation.attributeName === "style"
                  ) {
                    const currentOpacity =
                      window.getComputedStyle(actionButton).opacity;
                    if (parseFloat(currentOpacity) < 1) {
                      actionButton.style.setProperty(
                        "opacity",
                        "1",
                        "important"
                      );
                    }
                  }
                });
              });

              observer.observe(actionButton, {
                attributes: true,
                attributeFilter: ["style", "class"],
              });
            });
          });
        }

        // EXÉCUTION ULTRA-AGRESSIVE
        ensureActionButtonsVisible();
        optimizeForSmallScreens();

        // Re-vérifier plusieurs fois avec des délais différents
        setTimeout(ensureActionButtonsVisible, 50);
        setTimeout(optimizeForSmallScreens, 50);
        setTimeout(ensureActionButtonsVisible, 100);
        setTimeout(optimizeForSmallScreens, 100);
        setTimeout(ensureActionButtonsVisible, 250);
        setTimeout(optimizeForSmallScreens, 250);
        setTimeout(ensureActionButtonsVisible, 500);
        setTimeout(optimizeForSmallScreens, 500);
        setTimeout(ensureActionButtonsVisible, 1000);
        setTimeout(optimizeForSmallScreens, 1000);
        setTimeout(ensureActionButtonsVisible, 2000);
        setTimeout(optimizeForSmallScreens, 2000);

        // Démarrer l'observation continue
        setupButtonObserver();

        // Vérification périodique TRÈS fréquente
        setInterval(periodicCheck, 1000); // Toutes les secondes

        // Écouter TOUS les changements possibles
        window.addEventListener("resize", function () {
          setTimeout(ensureActionButtonsVisible, 50);
          setTimeout(ensureActionButtonsVisible, 200);
          setTimeout(optimizeForSmallScreens, 50);
          setTimeout(optimizeForSmallScreens, 200);
        });

        window.addEventListener("orientationchange", function () {
          setTimeout(ensureActionButtonsVisible, 100);
          setTimeout(ensureActionButtonsVisible, 500);
        });

        document.addEventListener("visibilitychange", function () {
          if (!document.hidden) {
            setTimeout(ensureActionButtonsVisible, 100);
          }
        });

        // Initialiser chaque polaroid
        polaroids.forEach((polaroid, index) => {
          // Récupérer la rotation de base
          const rotation =
            getComputedStyle(polaroid).getPropertyValue("--rotation") || "0deg";
          const inner = polaroid.querySelector(".polaroid-inner");

          // Définir l'état initial
          inner.style.transform = `rotate(${rotation})`;
          polaroid.setAttribute("aria-expanded", "false");

          // Animation d'entrée échelonnée
          setTimeout(() => {
            polaroid.style.animation = `fadeInPolaroid 0.8s ease-out forwards`;

            // Ajouter une animation de pulse subtile après l'entrée
            setTimeout(() => {
              if (!polaroid.classList.contains("flipped")) {
                polaroid.style.animation +=
                  ", polaroidPulse 3s ease-in-out infinite";
              }
            }, 800);
          }, index * 150);

          // Gestion des appareils tactiles
          if ("ontouchstart" in window) {
            polaroid.classList.add("touch-device");

            // Animation tactile améliorée
            polaroid.addEventListener("touchend", function () {
              const inner = this.querySelector(".polaroid-inner");
              inner.classList.add("flip-animation");

              // Feedback haptique si disponible
              if (navigator.vibrate) {
                navigator.vibrate(50);
              }

              setTimeout(() => {
                inner.classList.remove("flip-animation");
              }, 600);
            });
          }

          // Améliorer l'accessibilité en ajoutant des descriptions dynamiques
          const title = polaroid.getAttribute("data-title") || "Polaroid";
          const description = polaroid.getAttribute("data-description") || "";
          polaroid.setAttribute(
            "aria-label",
            `${title}. ${description}. Utilisez Enter ou Espace pour interagir.`
          );

          // Amélioration spécifique pour le polaroid p5 - s'assurer que l'action est toujours visible
          if (polaroid.classList.contains("p5")) {
            const actionButton = polaroid.querySelector(".polaroid-action");
            if (actionButton) {
              actionButton.style.opacity = "1";
              actionButton.style.visibility = "visible";
              actionButton.style.display = "block";
            }
          }

          // Ajouter un gestionnaire pour les changements de préférences de mouvement
          if (window.matchMedia) {
            const prefersReducedMotion = window.matchMedia(
              "(prefers-reduced-motion: reduce)"
            );

            function handleMotionPreference(e) {
              if (e.matches) {
                // Désactiver les animations pour les utilisateurs qui préfèrent moins de mouvement
                polaroid.style.animation = "none";
                inner.style.transition = "transform 0.2s ease";
              } else {
                // Réactiver les animations normales
                inner.style.transition =
                  "transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)";
              }
            }

            prefersReducedMotion.addListener(handleMotionPreference);
            handleMotionPreference(prefersReducedMotion); // Appliquer immédiatement
          }
        });

        // Ajouter des événements globaux pour l'amélioration de l'accessibilité

        // Gérer la navigation avec les flèches
        document.addEventListener("keydown", function (e) {
          const focusedElement = document.activeElement;

          if (focusedElement && focusedElement.classList.contains("polaroid")) {
            const allPolaroids = Array.from(
              document.querySelectorAll(".polaroid")
            );
            const currentIndex = allPolaroids.indexOf(focusedElement);
            let nextIndex = -1;

            switch (e.key) {
              case "ArrowRight":
              case "ArrowDown":
                e.preventDefault();
                nextIndex = (currentIndex + 1) % allPolaroids.length;
                break;
              case "ArrowLeft":
              case "ArrowUp":
                e.preventDefault();
                nextIndex =
                  (currentIndex - 1 + allPolaroids.length) %
                  allPolaroids.length;
                break;
              case "Home":
                e.preventDefault();
                nextIndex = 0;
                break;
              case "End":
                e.preventDefault();
                nextIndex = allPolaroids.length - 1;
                break;
            }

            if (nextIndex >= 0) {
              allPolaroids[nextIndex].focus();

              // Annoncer la navigation
              const title =
                allPolaroids[nextIndex].getAttribute("data-title") ||
                "Polaroid";
              announceToScreenReader(`Navigation vers ${title}`);
            }
          }
        });

        // Améliorer le contraste et la visibilité en fonction du thème
        function updatePolaroidContrast() {
          const isDarkMode =
            document.documentElement.classList.contains("dark-mode");

          polaroids.forEach((polaroid) => {
            const focusIndicator = polaroid.querySelector(
              ".polaroid-focus-indicator"
            );
            if (focusIndicator) {
              // Supprimer complètement les couleurs bleues et blanches - garder transparent
              focusIndicator.style.borderColor = "transparent";
              focusIndicator.style.boxShadow = "none";
              focusIndicator.style.opacity = "0";
            }
          });
        }

        // Observer les changements de thème
        const observer = new MutationObserver(updatePolaroidContrast);
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ["class"],
        });

        // Appliquer immédiatement
        updatePolaroidContrast();
      });
    </script>
  </body>
</html>
